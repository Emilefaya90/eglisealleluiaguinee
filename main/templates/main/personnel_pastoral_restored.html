{% extends 'main/base.html' %}
{% load static %}

{% block title %}Personnel Pastoral - Gestion Ã‰glise{% endblock %}

{% block content %}
<div class="page-content" style="position: relative; min-height: 100vh;">
    <div style="position: fixed; left: 0; bottom: 0; width: 100vw; height: auto; min-height: 40vh; z-index: 0; pointer-events: none;">
        <img src="{% static 'main/images/hero/fond8.jpg' %}" alt="Fond bas" style="width: 100vw; height: auto; display: block; object-fit: cover; object-position: bottom;">
    </div>
    <div class="container mt-4" style="position: relative; z-index: 2;">
        <div class="row">
            <div class="col-12">
                <!-- Messages de succÃ¨s et d'erreur -->
                {% if messages %}
                    <div class="mb-4">
                        {% for message in messages %}
                            {% if message.tags == 'success' %}
                                <div class="alert alert-success alert-dismissible fade show" role="alert" style="border-left: 5px solid #28a745; background-color: #d4edda; border-color: #c3e6cb;">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                                        <div>
                                            <h5 class="alert-heading mb-1"><strong>Enregistrement rÃ©ussi !</strong></h5>
                                            <p class="mb-0">{{ message }}</p>
                                        </div>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% elif message.tags == 'error' %}
                                <div class="alert alert-danger alert-dismissible fade show" role="alert" style="border-left: 5px solid #dc3545; background-color: #f8d7da; border-color: #f5c6cb;">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-exclamation-triangle fa-2x text-danger me-3"></i>
                                        <div>
                                            <h5 class="alert-heading mb-1"><strong>Erreur d'enregistrement</strong></h5>
                                            <p class="mb-0">{{ message }}</p>
                                        </div>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% elif message.tags == 'warning' %}
                                <div class="alert alert-warning alert-dismissible fade show" role="alert" style="border-left: 5px solid #ffc107; background-color: #fff3cd; border-color: #ffecb5;">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-exclamation-circle fa-2x text-warning me-3"></i>
                                        <div>
                                            <h5 class="alert-heading mb-1"><strong>Attention</strong></h5>
                                            <p class="mb-0">{{ message }}</p>
                                        </div>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% else %}
                                <div class="alert alert-info alert-dismissible fade show" role="alert" style="border-left: 5px solid #17a2b8; background-color: #d1ecf1; border-color: #bee5eb;">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-info-circle fa-2x text-info me-3"></i>
                                        <div>
                                            <h5 class="alert-heading mb-1"><strong>Information</strong></h5>
                                            <p class="mb-0">{{ message }}</p>
                                        </div>
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
                
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-center">
                        <h4 class="text-white m-0">PERSONNEL PASTORAL</h4>
                    </div>
                    
                    <!-- Modal Info Personnel Pastoral -->
                    <div class="modal fade" id="infoPersonnelModal" tabindex="-1" aria-labelledby="infoPersonnelModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content" style="border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                                <div class="modal-header bg-info text-white" style="border-bottom: 3px solid #0056b3;">
                                    <h5 class="modal-title" id="infoPersonnelModalLabel" style="font-weight: bold; font-size: 1.3rem;">
                                        <i class="fas fa-users-cog me-2"></i> Personnel Pastoral
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" style="padding: 25px; background-color: #f8f9fa;">
                                    <div class="card mb-4 border-primary">
                                        <div class="card-body">
                                            <h4 class="text-primary" style="font-weight: bold; border-bottom: 2px solid #0d6efd; padding-bottom: 10px;">
                                                ðŸ‘¨â€ðŸ’¼ Ã‰quipe Pastorale
                                            </h4>
                                            <p class="lead">Gestion complÃ¨te du personnel pastoral de l'Ã‰glise PentecÃ´te AllÃ©luia de GuinÃ©e.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100 border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h5 class="mb-0">ðŸ™ Pasteurs Principaux</h5>
                                                </div>
                                                <div class="card-body">
                                                    <p><strong>Direction spirituelle et administrative</strong></p>
                                                    <ul class="list-group list-group-flush">
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>Pasteur Principal</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>Pasteurs AssociÃ©s</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>ResponsabilitÃ©s spÃ©cifiques</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>Formations et qualifications</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100 border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h5 class="mb-0">â›ª MinistÃ¨res SpÃ©cialisÃ©s</h5>
                                                </div>
                                                <div class="card-body">
                                                    <p><strong>Personnel dÃ©diÃ© aux diffÃ©rents ministÃ¨res</strong></p>
                                                    <ul class="list-group list-group-flush">
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>MinistÃ¨re de la Jeunesse</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>MinistÃ¨re des Femmes</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>MinistÃ¨re de la Musique</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>MinistÃ¨re d'Ã‰vangÃ©lisation</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100 border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h5 class="mb-0">ðŸ“š Formation Continue</h5>
                                                </div>
                                                <div class="card-body">
                                                    <p><strong>DÃ©veloppement et formation du personnel</strong></p>
                                                    <ul class="list-group list-group-flush">
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>Programmes de formation</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>SÃ©minaires et confÃ©rences</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>Certifications</li>
                                                        <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i>Mentorat</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6 mb-4">
                                            <div class="card h-100 border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h5 class="mb-0">ðŸ“‹ Gestion Administrative</h5>
                                                </div>
                                                <div class="card-body">
                                                    <ul class="list-group list-group-flush">
                                                        <li class="list-group-item"><strong>Dossiers Personnel :</strong> Informations complÃ¨tes de chaque membre</li>
                                                        <li class="list-group-item"><strong>Planification :</strong> Horaires de service et responsabilitÃ©s</li>
                                                        <li class="list-group-item"><strong>Ã‰valuation :</strong> Suivi des performances et dÃ©veloppement</li>
                                                        <li class="list-group-item"><strong>Coordination :</strong> Communication entre Ã©quipes</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="background-color: #f0f0f0; border-top: 1px solid #dee2e6;">
                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                                        <i class="fas fa-times-circle me-1"></i> Fermer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Formulaire d'Enregistrement du Personnel Pastoral -->
                    <div class="modal fade" id="personnelFormModal" tabindex="-1" aria-labelledby="personnelFormModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                            <div class="modal-content" style="border-radius: 15px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                                <div class="modal-header text-white" style="background: linear-gradient(135deg, #ff8c00, #cc6600); border-bottom: 3px solid #b8860b;">
                                    <h5 class="modal-title" id="personnelFormModalLabel" style="font-weight: bold; font-size: 1.4rem; text-align: center; width: 100%;">
                                        <i class="fas fa-user-plus me-2"></i> FORMULAIRE D'ENREGISTREMENT DU PERSONNEL PASTORAL
                                    </h5>
                                </div>
                                <div class="modal-body" style="background: rgba(255,255,255,0.95); color: #333; border-radius: 8px; margin: 10px; max-height: 80vh; overflow-y: auto;">
                                    
                                    <!-- Messages de validation -->
                                    <div id="formErrorMessage" class="alert alert-danger d-none" style="font-weight: bold; border: 2px solid darkred;">
                                        <i class="fas fa-exclamation-triangle me-2"></i> Veuillez vÃ©rifier vos informations.
                                    </div>
                                    
                                    <div id="formSuccessMessage" class="alert alert-success d-none" style="font-weight: bold; border: 2px solid #28a745;">
                                        <i class="fas fa-check-circle me-2"></i> Enregistrement effectuÃ© avec succÃ¨s !
                                    </div>

                                    <form id="personnelForm">
                                        <!-- Section 1: Informations Personnelles -->
                                        <div class="card mb-4" style="border: 2px solid #ff8c00; border-radius: 10px;">
                                            <div class="card-header" style="background: linear-gradient(135deg, #ff8c00, #cc6600); color: white; font-weight: bold; text-align: center;">
                                                <h5 class="mb-0"><i class="fas fa-user me-2"></i> Section 1 : Informations Personnelles</h5>
                                            </div>
                                            <div class="card-body" style="background-color: #fff8f0;">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                         <label for="nom" class="form-label"><strong>Nom</strong></label>
                                                         <input type="text" class="form-control" id="nom" name="nom">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="prenoms" class="form-label"><strong>PrÃ©noms</strong></label>
                                                         <input type="text" class="form-control" id="prenoms" name="prenoms">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="date_naissance" class="form-label"><strong>Date de naissance</strong></label>
                                                         <input type="date" class="form-control" id="date_naissance" name="date_naissance">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="lieu_naissance" class="form-label"><strong>Lieu de naissance</strong></label>
                                                         <input type="text" class="form-control" id="lieu_naissance" name="lieu_naissance">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="nationalite" class="form-label"><strong>NationalitÃ©</strong></label>
                                                         <input type="text" class="form-control" id="nationalite" name="nationalite">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="telephone" class="form-label"><strong>TÃ©lÃ©phone</strong></label>
                                                         <input type="tel" class="form-control" id="telephone" name="telephone">
                                                    </div>
                                                    <div class="col-md-12 mb-3">
                                                        <label for="email" class="form-label"><strong>Email</strong></label>
                                                        <input type="email" class="form-control" id="email" name="email">
                                                    </div>
                                                    
                                                        
                                                     </div>
                                                 </div>
                                             </div>
                                         </div>

                                         <!-- Section 2: Filiations -->
                                         <div class="card mb-4" style="border: 2px solid #ff8c00; border-radius: 10px;">
                                             <div class="card-header" style="background: linear-gradient(135deg, #ff8c00, #cc6600); color: white; font-weight: bold; text-align: center;">
                                                 <h5 class="mb-0"><i class="fas fa-family me-2"></i> Section 2 : Filiations</h5>
                                             </div>
                                             <div class="card-body" style="background-color: #fff8f0;">
                                                 <div class="row">
                                                     <div class="col-md-6 mb-3">
                                                         <label for="pere" class="form-label"><strong>Nom du pÃ¨re</strong></label>
                                                         <input type="text" class="form-control" id="pere" name="pere">
                                                     </div>
                                                     <div class="col-md-6 mb-3">
                                                         <label for="mere" class="form-label"><strong>Nom de la mÃ¨re</strong></label>
                                                         <input type="text" class="form-control" id="mere" name="mere">
                                                     </div>
                                                     <div class="col-md-6 mb-3">
                                                         <label for="situation_matrimoniale" class="form-label"><strong>Situation matrimoniale</strong></label>
                                                         <select class="form-control" id="situation_matrimoniale" name="situation_matrimoniale">
                                                             <option value="">SÃ©lectionnez...</option>
                                                             <option value="CÃ©libataire">CÃ©libataire</option>
                                                             <option value="MariÃ©(e)">MariÃ©(e)</option>
                                                             <option value="Veuf(ve)">Veuf(ve)</option>
                                                             <option value="DivorcÃ©(e)">DivorcÃ©(e)</option>
                                                         </select>
                                                     </div>
                                                     <div class="col-md-6 mb-3">
                                                         <label for="conjoint" class="form-label"><strong>Nom du conjoint (si mariÃ©)</strong></label>
                                                         <input type="text" class="form-control" id="conjoint" name="conjoint">
                                                     </div>
                                                     <div class="col-md-12 mb-3">
                                                         <label for="enfants" class="form-label"><strong>Nombre d'enfants</strong></label>
                                                         <input type="number" class="form-control" id="enfants" name="enfants" min="0">
                                                     </div>
                                                 </div>
                                             </div>
                                         </div>

                                         <!-- Section 3: Affectation du Pasteur -->
                                         <div class="card mb-4" style="border: 2px solid #ff8c00; border-radius: 10px;">
                                             <div class="card-header" style="background: linear-gradient(135deg, #ff8c00, #cc6600); color: white; font-weight: bold; text-align: center;">
                                                 <h5 class="mb-0"><i class="fas fa-church me-2"></i> Section 3 : Affectation du Pasteur</h5>
                                             </div>
                                             <div class="card-body" style="background-color: #fff8f0;">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                         <label for="fonction" class="form-label"><strong>Fonction</strong></label>
                                                         <select class="form-control" id="fonction" name="fonction">
                                                            <option value="">SÃ©lectionnez...</option>
                                                            <option value="Pasteur Principal">Pasteur Principal</option>
                                                            <option value="Pasteur Assistant">Pasteur Assistant</option>
                                                            <option value="Ã‰vangÃ©liste">Ã‰vangÃ©liste</option>
                                                            <option value="Ancien">Ancien</option>
                                                            <option value="Diacre">Diacre</option>
                                                            <option value="Responsable Jeunesse">Responsable Jeunesse</option>
                                                            <option value="Responsable Femmes">Responsable Femmes</option>
                                                            <option value="Autre">Autre</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="eglise_affectee" class="form-label"><strong>Ã‰glise affectÃ©e</strong></label>
                                                         <input type="text" class="form-control" id="eglise_affectee" name="eglise_affectee">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="date_ordination" class="form-label"><strong>Date d'ordination</strong></label>
                                                        <input type="date" class="form-control" id="date_ordination" name="date_ordination">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                         <label for="date_affectation" class="form-label"><strong>Date d'affectation</strong></label>
                                                         <input type="date" class="form-control" id="date_affectation" name="date_affectation">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

{{ ... }}
                                        <!-- Section 4: Formations suivies -->
                                        <div class="card mb-4" style="border: 2px solid #ff8c00; border-radius: 10px;">
                                            <div class="card-header" style="background: linear-gradient(135deg, #ff8c00, #cc6600); color: white; font-weight: bold; text-align: center;">
                                                <h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i> Section 4 : Formations suivies</h5>
                                            </div>
                                            <div class="card-body" style="background-color: #fff8f0;">
                                                <div class="row">
                                                    <div class="col-md-12 mb-3">
                                                        <label for="formations" class="form-label"><strong>Formations thÃ©ologiques et pastorales</strong></label>
                                                        <textarea class="form-control" id="formations" name="formations" rows="4" placeholder="DÃ©crivez les formations, sÃ©minaires, Ã©tudes thÃ©ologiques suivies..."></textarea>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="niveau_etudes" class="form-label"><strong>Niveau d'Ã©tudes gÃ©nÃ©ral</strong></label>
                                                        <select class="form-control" id="niveau_etudes" name="niveau_etudes">
                                                            <option value="">SÃ©lectionnez...</option>
                                                            <option value="Primaire">Primaire</option>
                                                            <option value="Secondaire">Secondaire</option>
                                                            <option value="Universitaire">Universitaire</option>
                                                            <option value="Post-universitaire">Post-universitaire</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="specialites" class="form-label"><strong>SpÃ©cialitÃ©s ministÃ©rielles</strong></label>
                                                        <input type="text" class="form-control" id="specialites" name="specialites" placeholder="Ex: PrÃ©dication, Counseling, Musique...">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Section 5: TÃ©lÃ©chargement de documents PDF -->
                                        <div class="card mb-4" style="border: 2px solid #ff8c00; border-radius: 10px;">
                                            <div class="card-header" style="background: linear-gradient(135deg, #ff8c00, #cc6600); color: white; font-weight: bold; text-align: center;">
                                                <h5 class="mb-0"><i class="fas fa-file-pdf me-2"></i> Section 5 : Documents</h5>
                                            </div>
                                            <div class="card-body" style="background-color: #fff8f0;">
                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="cv_pdf" class="form-label"><strong>CV (PDF)</strong></label>
                                                        <input type="file" class="form-control" id="cv_pdf" name="cv_pdf" accept=".pdf">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="diplomes_pdf" class="form-label"><strong>DiplÃ´mes/Certificats (PDF)</strong></label>
                                                        <input type="file" class="form-control" id="diplomes_pdf" name="diplomes_pdf" accept=".pdf">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="recommandations_pdf" class="form-label"><strong>Lettres de recommandation (PDF)</strong></label>
                                                        <input type="file" class="form-control" id="recommandations_pdf" name="recommandations_pdf" accept=".pdf">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="autres_docs_pdf" class="form-label"><strong>Autres documents (PDF)</strong></label>
                                                        <input type="file" class="form-control" id="autres_docs_pdf" name="autres_docs_pdf" accept=".pdf">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer" style="background-color: #f0f0f0; border-top: 2px solid #ff8c00;">
                                    <button type="button" class="btn btn-secondary" id="quitFormBtn">
                                        <i class="fas fa-times me-1"></i> Quitter le formulaire
                                    </button>
                                    <button type="button" class="btn btn-success" id="submitFormBtn">
                                        <i class="fas fa-save me-1"></i> Enregistrer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                
                <!-- Messages de notification -->
                <div id="errorMessage" class="alert m-3" style="display: none; background-color: #ff0000; color: white; font-weight: bold; border: 2px solid darkred; box-shadow: 0 0 10px rgba(255,0,0,0.3);">
                    <i class="fas fa-exclamation-triangle me-2"></i> Une erreur s'est produite lors de l'enregistrement
                </div>
                
                <div id="successMessage" class="alert m-3" style="display: none; background-color: #28a745; color: white; font-weight: bold; border: 2px solid #1e7e34; box-shadow: 0 0 15px rgba(40,167,69,0.5); padding: 15px; font-size: 1.1rem; text-align: center;">
                    <i class="fas fa-check-circle me-2 fa-lg"></i> Enregistrement effectuÃ© avec succÃ¨s
                </div>
                
                <div class="card-body p-4">
            
            <!-- Guide rapide du formulaire (version compacte) -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="card border-primary mb-2" style="font-size: 0.9rem;">
                        <div class="card-header bg-primary text-white py-1">
                            <h6 class="m-0"><i class="fas fa-list-ul me-1"></i> Champs du formulaire</h6>
                        </div>
                        <div class="card-body p-2">
                            <div class="row">
                                <div class="col-sm-6"><i class="fas fa-camera text-primary me-1"></i> <strong>Photo</strong> (camÃ©ra/import)</div>
                                <div class="col-sm-6"><i class="fas fa-id-card text-primary me-1"></i> <strong>Nom et prÃ©noms</strong></div>
                                <div class="col-sm-6"><i class="fas fa-user-tie text-primary me-1"></i> <strong>Fonction et sexe</strong></div>
                                <div class="col-sm-6"><i class="fas fa-calendar text-primary me-1"></i> <strong>Date de naissance</strong></div>
                                <div class="col-sm-6"><i class="fas fa-envelope text-primary me-1"></i> <strong>Email</strong></div>
                                <div class="col-sm-6"><i class="fas fa-pray text-primary me-1"></i> <strong>Date de consÃ©cration</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-success mb-2" style="font-size: 0.9rem;">
                        <div class="card-header bg-success text-white py-1">
                            <h6 class="m-0"><i class="fas fa-lightbulb me-1"></i> Conseils d'utilisation</h6>
                        </div>
                        <div class="card-body p-2">
                            <div class="row">
                                <div class="col-sm-6"><i class="fas fa-info-circle text-success me-1"></i> <strong>Tous les champs</strong> optionnels</div>
                                <div class="col-sm-6"><i class="fas fa-camera text-success me-1"></i> <strong>Photo</strong> via camÃ©ra</div>
                                <div class="col-sm-6"><i class="fas fa-search text-success me-1"></i> <strong>Recherche</strong> par filtres</div>
                                <div class="col-sm-6"><i class="fas fa-edit text-success me-1"></i> <strong>Modification</strong> (crayon)</div>
                                <div class="col-sm-6"><i class="fas fa-trash text-success me-1"></i> <strong>Suppression</strong> (confirmer)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <form method="post" class="needs-validation" id="personnelForm" enctype="multipart/form-data" novalidate onsubmit="return validateForm()">
                {% csrf_token %}
                <input type="hidden" name="action" value="enregistrer_personnel">
                <input type="hidden" name="pasteur_id" id="pasteur_id" value="">
            
            <!-- Messages de validation -->
            <div id="errorMessage" class="alert alert-danger" style="display: none;">
                <i class="fas fa-exclamation-triangle me-2"></i> Veuillez remplir tous les champs obligatoires.
            </div>
            
            <div id="successMessage" class="alert alert-success" style="display: none;">
                <i class="fas fa-check-circle me-2"></i> Tous les champs obligatoires sont remplis.
            </div>
            
            <div class="form-section mb-4">
                <div class="d-flex align-items-center bg-light p-2 rounded-top border-bottom border-primary">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                        <i class="fas fa-user"></i>
                    </div>
                    <h4 class="section-title m-0">1 - Informations personnelles</h4>
                </div>
                <div class="p-3 bg-white rounded-bottom shadow-sm">
                <div class="row">
                    <div class="col-md-4 mb-3">
                  
                 
                    <div class="col-md-4 mb-3">
                        <label class="form-label required-field">PrÃ©noms</label>
                        <input type="text" class="form-control" name="prenoms" id="prenoms" value="{{ form_data.prenoms|default:'' }}" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required-field">Nom</label>
                        <input type="text" class="form-control" name="nom" id="nom" value="{{ form_data.nom|default:'' }}" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label required-field">Fonction</label>
                        <input type="text" class="form-control" name="fonction" id="fonction" value="{{ form_data.fonction|default:'' }}" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required-field">Sexe</label>
                        <select class="form-select" name="sexe" id="sexe" required>
                            <option value="">SÃ©lectionner...</option>
                            <option value="M" {% if form_data.sexe == 'M' %}selected{% endif %}>Masculin</option>
                            <option value="F" {% if form_data.sexe == 'F' %}selected{% endif %}>FÃ©minin</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required-field">Date de naissance</label>
                        <input type="date" class="form-control" name="date_naissance" id="date_naissance" value="{{ form_data.date_naissance|default:'' }}" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Lieu de naissance</label>
                        <input type="text" class="form-control" name="lieu_naissance" id="lieu_naissance" value="{{ form_data.lieu_naissance|default:'' }}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">NationalitÃ©</label>
                        <input type="text" class="form-control" name="nationalite" id="nationalite" value="{{ form_data.nationalite|default:'' }}">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Domicile</label>
                        <input type="text" class="form-control" name="domicile" id="domicile" value="{{ form_data.domicile|default:'' }}">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ã‰tat civil</label>
                        <select class="form-select" name="etat_civil" id="etat_civil">
                            <option value="">SÃ©lectionner...</option>
                            <option value="celibataire" {% if form_data.etat_civil == 'celibataire' %}selected{% endif %}>CÃ©libataire</option>
                            <option value="marie" {% if form_data.etat_civil == 'marie' %}selected{% endif %}>MariÃ©(e)</option>
                            <option value="divorce" {% if form_data.etat_civil == 'divorce' %}selected{% endif %}>DivorcÃ©(e)</option>
                            <option value="veuf" {% if form_data.etat_civil == 'veuf' %}selected{% endif %}>Veuf/Veuve</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label">Nb enfants</label>
                        <input type="number" min="0" class="form-control form-control-sm" name="nombre_enfants" id="nombre_enfants" value="{{ form_data.nombre_enfants|default:'' }}" style="width: 80px;">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Profession</label>
                        <input type="text" class="form-control" name="profession" id="profession" value="{{ form_data.profession|default:'' }}">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label required-field">TÃ©lÃ©phone</label>
                        <input type="tel" class="form-control" name="telephone" id="telephone" value="{{ form_data.telephone|default:'' }}" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" id="email">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Date de consÃ©cration</label>
                        <input type="date" class="form-control" name="date_consecration" id="date_consecration">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Lieu de consÃ©cration</label>
                        <input type="text" class="form-control" name="lieu_consecration" id="lieu_consecration">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">ConsacrÃ© par qui ?</label>
                        <input type="text" class="form-control" name="consacre_par" id="consacre_par">
                    </div>
                </div>
                </div>
            </div>
            
            <!-- Section Filiations -->
            <div class="form-section mb-4">
                <div class="d-flex align-items-center bg-light p-2 rounded-top border-bottom border-primary">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4 class="section-title m-0">2 - Filiations</h4>
                </div>
                <div class="p-3 bg-white rounded-bottom shadow-sm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">PrÃ©noms du PÃ¨re</label>
                            <input type="text" class="form-control" name="prenoms_pere" id="prenoms_pere">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">PrÃ©noms & Nom de la MÃ¨re</label>
                            <input type="text" class="form-control" name="prenoms_nom_mere" id="prenoms_nom_mere">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section Affectation du Pasteur -->
            <div class="form-section mb-4">
                <div class="d-flex align-items-center bg-light p-2 rounded-top border-bottom border-primary">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                        <i class="fas fa-church"></i>
                    </div>
                    <h4 class="section-title m-0">3 - Affectation du Pasteur</h4>
                </div>
                <div class="p-3 bg-white rounded-bottom shadow-sm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">Ã‰glise affectÃ©e</label>
                            <select class="form-select" name="eglise_affectee" id="eglise_affectee" required>
                                <option value="">SÃ©lectionner une Ã©glise...</option>
                                {% for eglise in eglises %}
                                <option value="{{ eglise.id }}" {% if form_data.eglise_affectee == eglise.id|stringformat:'s' %}selected{% endif %}>{{ eglise.nom }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Lieu d'affectation</label>
                            <input type="text" class="form-control" name="lieu_affectation" id="lieu_affectation" value="{{ form_data.lieu_affectation|default:'' }}">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Date d'affectation</label>
                            <input type="date" class="form-control" name="date_affectation" id="date_affectation" value="{{ form_data.date_affectation|default:'' }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">RÃ©gion</label>
                            <input type="text" class="form-control" name="region" id="region" value="{{ form_data.region|default:'' }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Zone</label>
                            <input type="text" class="form-control" name="zone" id="zone" value="{{ form_data.zone|default:'' }}">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section Formations suivies -->
            <div class="form-section mb-4">
                <div class="d-flex align-items-center bg-light p-2 rounded-top border-bottom border-primary">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h4 class="section-title m-0">4 - Formations suivies du Pasteur</h4>
                </div>
                <div class="p-3 bg-white rounded-bottom shadow-sm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Types de formations</label>
                            <textarea class="form-control" rows="3" name="types_formations" id="types_formations"></textarea>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Statut actuel du Pasteur</label>
                            <input class="form-control" list="statut_actuel_options" name="statut_actuel" id="statut_actuel" placeholder="SÃ©lectionner ou saisir un statut...">
                            <datalist id="statut_actuel_options">
                                <option value="Ã‰vÃªque">
                                <option value="Assistant Ã‰vÃªque">
                                <option value="RÃ©vÃ©rend Pasteur">
                                <option value="Pasteur Principal">
                                <option value="Pasteur Assistant">
                                <option value="Pasteur Stagiaire">
                                <option value="LaÃ¯c">
                                <option value="Ã‰tudient(e) Pasteur">
                                <option value="Ã‰vangÃ©liste">
                                <option value="Ancien">
                                <option value="Diacre">
                                <option value="Diaconesse">
                                <option value="Membre du ComitÃ© National">
                            </datalist>
                            <div class="form-text">Vous pouvez sÃ©lectionner une option ou saisir un autre statut</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section TÃ©lÃ©chargement de documents -->
            <div class="form-section mb-4">
                <div class="d-flex align-items-center bg-light p-2 rounded-top border-bottom border-primary">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                        <i class="fas fa-file-upload"></i>
                    </div>
                    <h4 class="section-title m-0">5 - TÃ©lÃ©chargement de la piÃ¨ce d'enregistrement</h4>
                </div>
                <div class="p-3 bg-white rounded-bottom shadow-sm">
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label">Joindre la fiche Ã  partir d'un rÃ©pertoire local</label>
                            <input type="file" class="form-control" name="document_fichier" id="document_fichier" accept=".pdf,.doc,.docx">
                            <div class="form-text">Fichiers autorisÃ©s : Word, PDF</div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <strong>NumÃ©risation des documents :</strong> Assurez-vous que tous les documents sont clairement lisibles et numÃ©risÃ©s en haute qualitÃ©.
                    </div>
                </div>
            </div>
            
            <div class="mt-4 mb-3 text-start">
                <button type="submit" class="btn btn-primary px-4">
                    <i class="fas fa-save me-2"></i> Enregistrer
                </button>
                <button type="reset" class="btn btn-outline-secondary ms-3 px-4" onclick="resetForm()">
                    <i class="fas fa-undo me-2"></i> RÃ©initialiser
                </button>
            </div>
                </div>
            </div>
        </div>
        
        <!-- Tableau des enregistrements existants -->
        <div class="col-12 mt-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary d-flex justify-content-between align-items-center">
    
                    
                    <!-- Barre de recherche et compteur -->
                    <div class="d-flex align-items-center">
                        <div class="input-group input-group-sm me-2" style="width: 250px;">
                            <input type="text" class="form-control" id="tableSearch" placeholder="Rechercher...">
                            <button class="btn btn-light" type="button" id="clearSearch">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <span class="badge bg-light text-dark" id="pasteurCount">{{ pasteurs|length }} pasteur(s)</span>
                    </div>
                </div>
                
                <!-- ContrÃ´les de navigation du tableau -->
                <div class="p-2 bg-light border-bottom">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-outline-primary" id="toggleColumnsBtn" title="Afficher/Masquer des colonnes">
                                <i class="fas fa-columns me-1"></i> Colonnes
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="exportTableBtn" title="Exporter les donnÃ©es">
                                <i class="fas fa-file-export me-1"></i> Exporter
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="printTableBtn" title="Imprimer le tableau">
                                <i class="fas fa-print me-1"></i> Imprimer
                            </button>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="fixedHeadersSwitch" checked>
                                <label class="form-check-label small" for="fixedHeadersSwitch">En-tÃªtes fixes</label>
                            </div>
                            <select class="form-select form-select-sm" id="tablePageSize" style="width: auto;">
                                <option value="2" selected>2 lignes</option>
                                <option value="5">5 lignes</option>
                                <option value="10">10 lignes</option>
                                <option value="25">25 lignes</option>
                                <option value="50">50 lignes</option>
                                <option value="-1">Tout afficher</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <div class="table-responsive" style="overflow-x: auto; overflow-y: auto; max-width: 100%; max-height: 300px;">
                        <table class="table table-hover table-striped table-nowrap mb-0" style="font-size: 0.85rem; min-width: 2500px;">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col" class="text-center" style="width: 80px;">Photo</th>
                                    <th scope="col">Nom & PrÃ©noms</th>
                                    <th scope="col">Fonction</th>
                                    <th scope="col">Sexe</th>
                                    <th scope="col">Date de naissance</th>
                                    <th scope="col">Lieu de naissance</th>
                                    <th scope="col">NationalitÃ©</th>
                                    <th scope="col">Domicile</th>
                                    <th scope="col">Ã‰tat civil</th>
                                    <th scope="col">Nb d'enfants</th>
                                    <th scope="col">Profession</th>
                                    <th scope="col">TÃ©lÃ©phone</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Date de consÃ©cration</th>
                                    <th scope="col">Lieu de consÃ©cration</th>
                                    <th scope="col">ConsacrÃ© par qui ?</th>
                                    <th scope="col">PrÃ©noms du PÃ¨re</th>
                                    <th scope="col">PrÃ©noms & Nom de la MÃ¨re</th>
                                    <th scope="col">Ã‰glise affectÃ©e</th>
                                    <th scope="col">Lieu d'affectation</th>
                                    <th scope="col">Date d'affectation</th>
                                    <th scope="col">RÃ©gion</th>
                                    <th scope="col">Zone</th>
                                    <th scope="col">Types de formations</th>
                                    <th scope="col">Statut actuel du Pasteur</th>
                                    <th scope="col">Fiche ci-joint</th>
                                    <th scope="col" class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pasteur in pasteurs %}
                                <tr data-id="{{ pasteur.id }}" class="pasteur-row">
                                    <td class="text-center">
                                        {% if pasteur.photo %}
                                        <img src="{{ pasteur.photo.url }}" alt="Photo" class="rounded-circle" width="50" height="50">
                                        {% else %}
                                        <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; margin: 0 auto;">
                                            <i class="fas fa-user text-white"></i>
                                        </div>
                                        {% endif %}
                                    </td>
                                    <td>{{ pasteur.nom }} {{ pasteur.prenom }}</td>
                                    <td>{{ pasteur.fonction|default:"-" }}</td>
                                    <td>{{ pasteur.sexe|default:"-" }}</td>
                                    <td>{{ pasteur.date_naissance|date:"d/m/Y"|default:"-" }}</td>
                                    <td>{{ pasteur.lieu_naissance|default:"-" }}</td>
                                    <td>{{ pasteur.nationalite|default:"-" }}</td>
                                    <td>{{ pasteur.domicile|default:"-" }}</td>
                                    <td>{{ pasteur.etat_civil|default:"-" }}</td>
                                    <td>{{ pasteur.nombre_enfants|default:"0" }}</td>
                                    <td>{{ pasteur.profession|default:"-" }}</td>
                                    <td>{{ pasteur.telephone|default:"-" }}</td>
                                    <td>{{ pasteur.email|default:"-" }}</td>
                                    <td>{{ pasteur.date_consecration|date:"d/m/Y"|default:"-" }}</td>
                                    <td>{{ pasteur.lieu_consecration|default:"-" }}</td>
                                    <td>{{ pasteur.consacre_par|default:"-" }}</td>
                                    <td>{{ pasteur.prenoms_pere|default:"-" }}</td>
                                    <td>{{ pasteur.prenoms_nom_mere|default:"-" }}</td>
                                    <td>{{ pasteur.eglise.nom|default:"-" }}</td>
                                    <td>{{ pasteur.lieu_affectation|default:"-" }}</td>
                                    <td>{{ pasteur.date_affectation|date:"d/m/Y"|default:"-" }}</td>
                                    <td>{{ pasteur.region|default:"-" }}</td>
                                    <td>{{ pasteur.zone|default:"-" }}</td>
                                    <td>{{ pasteur.types_formations|default:"-" }}</td>
                                    <td>{{ pasteur.statut_actuel|default:"-" }}</td>
                                    <td>
                                        {% if pasteur.document_fichier %}
                                        <a href="{{ pasteur.document_fichier.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-file-download"></i>
                                        </a>
                                        {% else %}
                                        -
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-sm btn-info view-pasteur" data-id="{{ pasteur.id }}" title="Voir dÃ©tails">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-primary edit-pasteur" data-id="{{ pasteur.id }}" title="Modifier">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-danger delete-pasteur" data-id="{{ pasteur.id }}" title="Supprimer">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="27" class="text-center py-4">
                                        <div class="alert alert-info m-0">
                                            <i class="fas fa-info-circle me-2"></i> Aucun personnel pastoral enregistrÃ© pour le moment.
                                            <div class="mt-2">
                                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#personnelModal">
                                                    <i class="fas fa-plus-circle me-1"></i> Ajouter un membre du personnel
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Pagination du tableau -->
                <div class="table-pagination">
                    <div class="d-flex align-items-center">
                        <span class="me-2">Page <span id="currentPage">1</span> sur <span id="totalPages">1</span></span>
                        <div class="btn-group btn-group-sm">
                            <button type="button" class="btn btn-outline-primary" id="firstPageBtn" disabled>
                                <i class="fas fa-angle-double-left"></i>
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="prevPageBtn" disabled>
                                <i class="fas fa-angle-left"></i>
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="nextPageBtn" disabled>
                                <i class="fas fa-angle-right"></i>
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="lastPageBtn" disabled>
                                <i class="fas fa-angle-double-right"></i>
                            </button>
                        </div>
                    </div>
                    <div>
                        <span>Affichage de <span id="startRecord">0</span> Ã  <span id="endRecord">0</span> sur <span id="totalRecords">0</span> enregistrements</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Styles CSS pour amÃ©liorer l'apparence du formulaire -->
<style>
.form-section {
    margin-bottom: 25px;
}

/* Style pour que les textes du tableau restent sur une seule ligne */
.table-nowrap td, .table-nowrap th {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px; /* Limite la largeur maximale */
}

.section-title {
    color: #495057;
    font-weight: 600;
    font-size: 1.1rem;
}

.form-label {
    font-weight: 500;
    color: #495057;
}

.form-control:focus,
.form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.card-header {
    background: linear-gradient(135deg, #0062cc, #007bff);
}

.card {
    border-radius: 10px;
    overflow: hidden;
}

.bg-light {
    background-color: #f8f9fa !important;
}

.required-field::after {
    content: ' *';
    color: #dc3545;
    font-weight: bold;
}

.form-label.text-danger {
    color: #dc3545 !important;
}

.is-invalid {
    border-color: #dc3545 !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}
</style>

<!-- Scripts JavaScript pour le formulaire -->
<script>
// Fonction pour rÃ©initialiser le formulaire
function resetForm() {
    // RÃ©initialiser tous les champs du formulaire
    document.getElementById('personnelForm').reset();
    
    // RÃ©initialiser les champs spÃ©cifiques qui pourraient nÃ©cessiter un traitement particulier
    document.getElementById('nombre_enfants').value = '0';
    
    // Masquer le message d'erreur s'il est affichÃ©
    document.getElementById('errorMessage').style.display = 'none';
    
    // RÃ©initialiser la photo
    const photoPreview = document.getElementById('photoPreview');
    if (photoPreview) photoPreview.style.display = 'none';
    
    const previewImage = document.getElementById('previewImage');
    if (previewImage) previewImage.src = '';
    
    const openCameraBtn = document.getElementById('openCameraBtn');
    if (openCameraBtn) openCameraBtn.style.display = 'inline-block';
    
    // RÃ©initialiser l'ID cachÃ© pour l'Ã©dition
    document.getElementById('pasteur_id').value = '';
    
    // Changer le texte du bouton de soumission
    const submitButton = document.querySelector('button[type="submit"]');
    if (submitButton) submitButton.innerHTML = '<i class="fas fa-save me-2"></i> Enregistrer';
    
    return false; // EmpÃªcher le comportement par dÃ©faut du bouton
}

// Fonction pour valider les champs obligatoires spÃ©cifiÃ©s
function validateForm() {
    console.log('=== VALIDATION DES CHAMPS OBLIGATOIRES ===');
    
    // Liste des champs obligatoires avec leurs noms d'affichage
    const requiredFields = [
        { id: 'prenoms', name: 'PrÃ©noms' },
        { id: 'nom', name: 'Nom' },
        { id: 'fonction', name: 'Fonction' },
        { id: 'sexe', name: 'Sexe' },
        { id: 'date_naissance', name: 'Date de naissance' },
        { id: 'telephone', name: 'TÃ©lÃ©phone' },
        { id: 'eglise_affectee', name: 'Ã‰glise affectÃ©e' }
    ];
    
    let isValid = true;
    let emptyFields = [];
    
    // VÃ©rifier chaque champ obligatoire
    requiredFields.forEach(function(field) {
        const element = document.getElementById(field.id);
        if (!element) {
            console.error(`Champ ${field.id} non trouvÃ©!`);
            return;
        }
        
        const fieldValue = element.value ? element.value.trim() : '';
        console.log(`VÃ©rification ${field.name}:`, fieldValue ? 'REMPLI' : 'VIDE');
        
        if (!fieldValue) {
            isValid = false;
            emptyFields.push(field.name);
            // Mettre en Ã©vidence le champ vide
            element.classList.add('is-invalid');
            element.style.border = '2px solid #dc3545';
            element.style.boxShadow = '0 0 5px rgba(220, 53, 69, 0.5)';
        } else {
            // Retirer la mise en Ã©vidence si le champ est rempli
            element.classList.remove('is-invalid');
            element.style.border = '';
            element.style.boxShadow = '';
        }
    });
    
    // Masquer les messages prÃ©cÃ©dents
    const successMessage = document.getElementById('successMessage');
    if (successMessage) successMessage.style.display = 'none';
    
    // Afficher ou masquer le message d'erreur
    const errorMessage = document.getElementById('errorMessage');
    if (errorMessage) {
        if (!isValid) {
            errorMessage.style.display = 'block';
            errorMessage.innerHTML = `<i class="fas fa-exclamation-triangle me-2"></i> Veuillez remplir les champs obligatoires suivants : <strong>${emptyFields.join(', ')}</strong>`;
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false; // EmpÃªcher la soumission du formulaire
        } else {
            errorMessage.style.display = 'none';
            
            // Afficher le message de succÃ¨s
            if (successMessage) {
                successMessage.style.display = 'block';
                successMessage.innerHTML = '<i class="fas fa-check-circle me-2 fa-lg"></i> Tous les champs obligatoires sont remplis. Enregistrement en cours...';
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                successMessage.classList.add('pulse-animation');
            }
            
            return true; // Permettre la soumission du formulaire
        }
    }
    
    return isValid;
}

// Ajouter des Ã©couteurs d'Ã©vÃ©nements pour masquer le message d'erreur lorsque l'utilisateur commence Ã  saisir
document.addEventListener('DOMContentLoaded', function() {
    const requiredInputs = document.querySelectorAll('#personnelForm [required]');
    requiredInputs.forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('is-invalid');
            // VÃ©rifier si tous les champs obligatoires sont remplis
            const allFilled = Array.from(requiredInputs).every(field => field.value.trim() !== '');
            if (allFilled) {
                document.getElementById('errorMessage').style.display = 'none';
            }
        });
    });
    
    // RÃ©initialiser la photo
    const photoPreview = document.getElementById('photoPreview');
    const previewImage = document.getElementById('previewImage');
    const openCameraBtn = document.getElementById('openCameraBtn');
    
    if (photoPreview && previewImage && openCameraBtn) {
        photoPreview.style.display = 'none';
        previewImage.src = '';
        openCameraBtn.style.display = 'inline-block';
    }
    
    // RÃ©initialiser l'ID cachÃ© pour l'Ã©dition
    document.getElementById('pasteur_id').value = '';
    
    // Changer le texte du bouton de soumission
    const submitButton = document.querySelector('button[type="submit"]');
    submitButton.innerHTML = '<i class="fas fa-save me-2"></i> Enregistrer';
});

// Fonction pour afficher les dÃ©tails d'un pasteur dans un modal
function showPasteurDetails(pasteurId) {
    // Faire une requÃªte AJAX pour obtenir les dÃ©tails du pasteur
    fetch(`/get_pasteur_details/${pasteurId}/`)
        .then(response => response.json())
        .then(data => {
            // CrÃ©er le contenu du modal
            let modalContent = `
                <div class="modal fade" id="pasteurDetailsModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title"><i class="fas fa-user me-2"></i> DÃ©tails du Pasteur</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-4 text-center mb-3">
                                        ${data.photo ? 
                                            `<img src="${data.photo}" alt="Photo" class="img-fluid rounded-circle" style="max-width: 150px;">` : 
                                            `<div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 150px; height: 150px;">
                                                <i class="fas fa-user fa-4x text-white"></i>
                                            </div>`
                                        }
                                    </div>
                                    <div class="col-md-8">
                                        <h4>${data.nom} ${data.prenom}</h4>
                                        <p class="badge bg-primary">${data.poste}</p>
                                    </div>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <h5 class="border-bottom pb-2">Informations personnelles</h5>
                                        <p><strong>Sexe:</strong> ${data.sexe === 'M' ? 'Masculin' : 'FÃ©minin'}</p>
                                        <p><strong>Date de naissance:</strong> ${new Date(data.date_naissance).toLocaleDateString()}</p>
                                        <p><strong>TÃ©lÃ©phone:</strong> ${data.telephone}</p>
                                        <p><strong>Email:</strong> ${data.email || 'Non renseignÃ©'}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h5 class="border-bottom pb-2">Informations professionnelles</h5>
                                        <p><strong>Ã‰glise affectÃ©e:</strong> ${data.eglise_nom || 'Non affectÃ©'}</p>
                                        <p><strong>Date d'embauche:</strong> ${new Date(data.date_embauche).toLocaleDateString()}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="loadPasteurForEdit(${pasteurId})" data-bs-dismiss="modal">
                                    <i class="fas fa-edit me-2"></i> Modifier
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-2"></i> Fermer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Afficher le modal avec les dÃ©tails du pasteur
            const detailsModal = document.getElementById('pasteurDetailsModal');
            if (detailsModal) {
                detailsModal.innerHTML = modalContent;
                const bsModal = new bootstrap.Modal(detailsModal);
                bsModal.show();
            }
        })
        .catch(error => {
            console.error('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails:', error);
            alert('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails du pasteur.');
        });
}

// Les fonctions openCamera et stopCamera ont Ã©tÃ© dÃ©placÃ©es dans le bloc JavaScript principal en bas de page

// Les Ã©couteurs d'Ã©vÃ©nements pour la camÃ©ra et la photo ont Ã©tÃ© dÃ©placÃ©s dans le bloc JavaScript principal en bas de page
    
    // FonctionnalitÃ© de recherche dans le tableau
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    
    if (searchInput && searchButton) {
        // Fonction de recherche
        function performSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const tableRows = document.querySelectorAll('table tbody tr');
            
            // Si la ligne "aucun personnel pastoral" est la seule prÃ©sente, ne rien faire
            if (tableRows.length === 1 && tableRows[0].querySelector('td[colspan]')) {
                return;
            }
            
            let hasResults = false;
            let visibleCount = 0;
            
            tableRows.forEach(row => {
                // Ignorer la ligne "aucun personnel pastoral"
                if (row.querySelector('td[colspan]')) {
                    return;
                }
                
                const nom = row.cells[1].textContent.toLowerCase();
                const fonction = row.cells[2].textContent.toLowerCase();
                const telephone = row.cells[6].textContent.toLowerCase();
                
                // VÃ©rifier si le terme de recherche est prÃ©sent dans l'une des colonnes
                if (searchTerm === '' || 
                    nom.includes(searchTerm) || 
                    fonction.includes(searchTerm) || 
                    telephone.includes(searchTerm)) {
                    row.style.display = '';
                    hasResults = true;
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Afficher un message si aucun rÃ©sultat
            const noResultsRow = document.getElementById('noResultsRow');
            if (!hasResults) {
                if (!noResultsRow) {
                    const tbody = document.querySelector('table tbody');
                    const newRow = document.createElement('tr');
                    newRow.id = 'noResultsRow';
                    newRow.innerHTML = `
                        <td colspan="8" class="text-center py-4">
                            <div class="alert alert-warning m-0">
                                <i class="fas fa-exclamation-circle me-2"></i> Aucun rÃ©sultat trouvÃ© pour "${searchTerm}".
                            </div>
                        </td>
                    `;
                    tbody.appendChild(newRow);
                } else {
                    noResultsRow.querySelector('.alert').innerHTML = `
                        <i class="fas fa-exclamation-circle me-2"></i> Aucun rÃ©sultat trouvÃ© pour "${searchTerm}".
                    `;
                    noResultsRow.style.display = '';
                }
            } else if (noResultsRow) {
                noResultsRow.style.display = 'none';
            }
            
            // Mettre Ã  jour le compteur de pasteurs
            const pasteurCount = document.getElementById('pasteurCount');
            if (pasteurCount) {
                pasteurCount.textContent = visibleCount;
            }
        }
        
        // Ã‰vÃ©nements de recherche
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        });
        
        // Recherche en temps rÃ©el (aprÃ¨s un court dÃ©lai)
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(performSearch, 300);
        });
        
        // Fonction pour afficher les dÃ©tails d'un pasteur dans un modal
        function showPasteurDetails(pasteurId) {
            // RÃ©cupÃ©rer les dÃ©tails du pasteur via AJAX
            fetch(`/get_pasteur_details/${pasteurId}/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails');
                    }
                    return response.json();
                })
                .then(data => {
                    // CrÃ©er le contenu du modal avec les dÃ©tails du pasteur
                    const modalContent = 
                        '<div class="modal fade" id="pasteurDetailsModal" tabindex="-1" aria-labelledby="pasteurDetailsModalLabel" aria-hidden="true">' +
                            '<div class="modal-dialog modal-lg">' +
                                '<div class="modal-content">' +
                                    '<div class="modal-header bg-info text-white">' +
                                        '<h5 class="modal-title" id="pasteurDetailsModalLabel">DÃ©tails du Pasteur</h5>' +
                                        '<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>' +
                                    '</div>' +
                                    '<div class="modal-body">' +
                                        '<div class="row">' +
                                            '<div class="col-md-4 text-center mb-3">' +
                                                '<img src="' + (data.photo || '/static/img/default-user.png') + '" alt="Photo du pasteur" class="img-fluid rounded-circle" style="max-width: 150px; max-height: 150px;">' +
                                            '</div>' +
                                            '<div class="col-md-8">' +
                                                '<h4>' + data.nom + ' ' + data.prenom + '</h4>' +
                                                '<p class="badge bg-primary">' + data.poste + '</p>' +
                                                '<p><strong>Ã‰glise:</strong> ' + (data.eglise_nom || 'Non affectÃ©') + '</p>' +
                                            '</div>' +
                                        '</div>' +
                                        '<hr>' +
                                        '<div class="row mt-3">' +
                                            '<div class="col-md-6">' +
                                                '<p><strong>Sexe:</strong> ' + (data.sexe === 'M' ? 'Masculin' : 'FÃ©minin') + '</p>' +
                                                '<p><strong>Date de naissance:</strong> ' + (data.date_naissance || 'Non spÃ©cifiÃ©e') + '</p>' +
                                            '</div>' +
                                            '<div class="col-md-6">' +
                                                '<p><strong>TÃ©lÃ©phone:</strong> ' + (data.telephone || 'Non spÃ©cifiÃ©') + '</p>' +
                                                '<p><strong>Email:</strong> ' + (data.email || 'Non spÃ©cifiÃ©') + '</p>' +
                                                '<p><strong>Date d\'embauche:</strong> ' + (data.date_embauche || 'Non spÃ©cifiÃ©e') + '</p>' +
                                            '</div>' +
                                        '</div>' +
                                    '</div>' +
                                    '<div class="modal-footer">' +
                                        '<button type="button" class="btn btn-primary" onclick="loadPasteurForEdit(' + pasteurId + ')" data-bs-dismiss="modal">' +
                                            '<i class="fas fa-edit me-2"></i> Modifier' +
                                        '</button>' +
                                        '<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">' +
                                            '<i class="fas fa-times me-2"></i> Fermer' +
                                        '</button>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>';
                    
                    // Supprimer l'ancien modal s'il existe
                    const oldModal = document.getElementById('pasteurDetailsModal');
                    if (oldModal) {
                        oldModal.remove();
                    }
                    
                    // Ajouter le nouveau modal au DOM
                    document.body.insertAdjacentHTML('beforeend', modalContent);
                    
                    // Afficher le modal
                    const modal = new bootstrap.Modal(document.getElementById('pasteurDetailsModal'));
                    modal.show();
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    alert('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails du pasteur.');
                });
        }
        
        // Fonction pour charger les donnÃ©es d'un pasteur dans le formulaire pour modification
        function loadPasteurForEdit(pasteurId) {
            // RÃ©cupÃ©rer les dÃ©tails du pasteur via AJAX
            fetch(`/get_pasteur_details/${pasteurId}/`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails');
                    }
                    return response.json();
                })
                .then(data => {
                    // Ouvrir le modal du formulaire
                    const personnelModal = new bootstrap.Modal(document.getElementById('personnelModal'));
                    personnelModal.show();
                    
                    // Remplir le formulaire avec les donnÃ©es du pasteur
                    document.getElementById('pasteur_id').value = data.id;
                    document.getElementById('nom').value = data.nom;
                    document.getElementById('prenoms').value = data.prenom;
                    document.getElementById('fonction').value = data.poste;
                    
                    // SÃ©lectionner le sexe
                    const sexeRadios = document.querySelectorAll('input[name="sexe"]');
                    sexeRadios.forEach(radio => {
                        if (radio.value === data.sexe) {
                            radio.checked = true;
                        }
                    });
                    
                    // Remplir les autres champs
                    document.getElementById('date_naissance').value = data.date_naissance;
                    document.getElementById('telephone').value = data.telephone;
                    document.getElementById('email').value = data.email;
                    document.getElementById('date_embauche').value = data.date_embauche;
                    document.getElementById('date_consecration').value = data.date_consecration || '';
                    document.getElementById('lieu_consecration').value = data.lieu_consecration || '';
                    document.getElementById('consacre_par').value = data.consacre_par || '';
                    
                    // SÃ©lectionner l'Ã©glise
                    const egliseSelect = document.getElementById('eglise_affectee');
                    if (egliseSelect) {
                        for (let i = 0; i < egliseSelect.options.length; i++) {
                            if (egliseSelect.options[i].value == data.eglise_id) {
                                egliseSelect.selectedIndex = i;
                                break;
                            }
                        }
                    }
                    
                    // Afficher la photo si disponible
                    if (data.photo) {
                        const photoPreview = document.getElementById('photoPreview');
                        const previewImage = document.getElementById('previewImage');
                        const openCameraBtn = document.getElementById('openCameraBtn');
                        
                        if (photoPreview && previewImage && openCameraBtn) {
                            photoPreview.style.display = 'block';
                            previewImage.src = data.photo;
                            openCameraBtn.style.display = 'none';
                        }
                    }
                    
                    // Changer le texte du bouton de soumission pour indiquer une modification
                    const submitBtn = document.querySelector('#personnelForm button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="fas fa-save me-2"></i> Mettre Ã  jour';
                    }
                    
                    // Changer l'action du formulaire
                    const form = document.getElementById('personnelForm');
                    if (form) {
                        form.action = `/update_pasteur/${data.id}/`;
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    if (error.message.includes('404') || error.message.includes('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails')) {
                        alert('Ce pasteur n\'existe plus dans la base de donnÃ©es. La liste va Ãªtre actualisÃ©e.');
                        // Recharger la page pour actualiser la liste
                        window.location.reload();
                    } else {
                        alert('Erreur lors de la rÃ©cupÃ©ration des donnÃ©es du pasteur: ' + error.message);
                    }
                });
        }
        
        // Fonction pour confirmer la suppression d'un pasteur
        function confirmDeletePasteur(pasteurId) {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer ce pasteur ? Cette action est irrÃ©versible.')) {
                // RÃ©cupÃ©rer le token CSRF
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                // Envoyer la requÃªte de suppression
                fetch(`/delete_pasteur/${pasteurId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    },
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de la suppression');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Supprimer la ligne du tableau
                        const row = document.querySelector('tr[data-id="' + pasteurId + '"]');
                        if (row) {
                            row.remove();
                        }
                        
                        // Mettre Ã  jour le compteur de pasteurs
                        updatePasteurCount();
                        
                        // Afficher un message de succÃ¨s
                        alert(data.message);
                    } else {
                        throw new Error(data.error || 'Erreur inconnue');
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    alert('Erreur lors de la suppression du pasteur.');
                });
            }
        }
        
        // Fonction pour mettre Ã  jour le compteur de pasteurs
        function updatePasteurCount() {
            const tableRows = document.querySelectorAll('table tbody tr');
            let visibleCount = 0;
            
            tableRows.forEach(row => {
                if (row.style.display !== 'none' && !row.querySelector('td[colspan="9"]')) {
                    visibleCount++;
                }
            });
            
            // Mettre Ã  jour le badge de compteur
            const countBadge = document.getElementById('pasteurCount');
            if (countBadge) {
                countBadge.textContent = visibleCount;
            }
            
            // Afficher un message si aucun pasteur n'est visible
            const tbody = document.querySelector('table tbody');
            const noResultRow = document.querySelector('tr.no-result-row');
            
            if (visibleCount === 0) {
                if (!noResultRow) {
                    const searchTerm = document.getElementById('searchInput').value.trim();
                    const message = searchTerm ? 
                        `Aucun rÃ©sultat trouvÃ© pour "${searchTerm}"` : 
                        'Aucun personnel pastoral enregistrÃ© pour le moment';
                    
                    const newRow = 
                        '<tr class="no-result-row">' +
                            '<td colspan="9" class="text-center py-3">' + message + '</td>' +
                        '</tr>';
                    tbody.innerHTML += newRow;
                }
            } else if (noResultRow) {
                noResultRow.remove();
            }
        }
        
        // Gestionnaires d'Ã©vÃ©nements pour les boutons d'action
        
        // Bouton Voir dÃ©tails
        document.querySelectorAll('.view-pasteur').forEach(button => {
            button.addEventListener('click', function() {
                const pasteurId = this.getAttribute('data-id');
                // Afficher les dÃ©tails du pasteur dans un modal
                showPasteurDetails(pasteurId);
            });
        });
        
        // Bouton Modifier
        document.querySelectorAll('.edit-pasteur').forEach(button => {
            button.addEventListener('click', function() {
                const pasteurId = this.getAttribute('data-id');
                // Charger les donnÃ©es du pasteur dans le formulaire pour modification
                loadPasteurForEdit(pasteurId);
            });
        });
        
        // Bouton Supprimer
        document.querySelectorAll('.delete-pasteur').forEach(button => {
            button.addEventListener('click', function() {
                const pasteurId = this.getAttribute('data-id');
                // Demander confirmation avant suppression
                confirmDeletePasteur(pasteurId);
            });
        });
    }

// Fonction pour afficher les dÃ©tails d'un pasteur dans un modal
function showPasteurDetails(pasteurId) {
    // Faire une requÃªte AJAX pour obtenir les dÃ©tails du pasteur
    fetch(`/get_pasteur_details/${pasteurId}/`)
        .then(response => response.json())
        .then(data => {
            // CrÃ©er le contenu du modal
            let modalContent = `
                <div class="modal fade" id="pasteurDetailsModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title"><i class="fas fa-user me-2"></i> DÃ©tails du Pasteur</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-4 text-center mb-3">
                                        ${data.photo ? 
                                            `<img src="${data.photo}" alt="Photo" class="img-fluid rounded-circle" style="max-width: 150px;">` : 
                                            `<div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 150px; height: 150px;">
                                                <i class="fas fa-user fa-4x text-white"></i>
                                            </div>`
                                        }
                                    </div>
                                    <div class="col-md-8">
                                        <h4>${data.nom} ${data.prenom}</h4>
                                        <p class="badge bg-primary">${data.poste}</p>
                                    </div>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <h5 class="border-bottom pb-2">Informations personnelles</h5>
                                        <p><strong>Sexe:</strong> ${data.sexe === 'M' ? 'Masculin' : 'FÃ©minin'}</p>
                                        <p><strong>Date de naissance:</strong> ${new Date(data.date_naissance).toLocaleDateString()}</p>
                                        <p><strong>TÃ©lÃ©phone:</strong> ${data.telephone}</p>
                                        <p><strong>Email:</strong> ${data.email || 'Non renseignÃ©'}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h5 class="border-bottom pb-2">Informations professionnelles</h5>
                                        <p><strong>Ã‰glise affectÃ©e:</strong> ${data.eglise_nom || 'Non affectÃ©'}</p>
                                        <p><strong>Date d'embauche:</strong> ${new Date(data.date_embauche).toLocaleDateString()}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="loadPasteurForEdit(${pasteurId})" data-bs-dismiss="modal">
                                    <i class="fas fa-edit me-2"></i> Modifier
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-2"></i> Fermer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Ajouter le modal au document
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalContent;
            document.body.appendChild(modalContainer.firstElementChild);
            
            // Afficher le modal
            const modal = new bootstrap.Modal(document.getElementById('pasteurDetailsModal'));
            modal.show();
            
            // Supprimer le modal du DOM aprÃ¨s sa fermeture
            document.getElementById('pasteurDetailsModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        })
        .catch(error => {
            console.error('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails:', error);
            alert('Impossible de rÃ©cupÃ©rer les dÃ©tails du pasteur.');
        });
}

// Fonction pour charger les donnÃ©es d'un pasteur dans le formulaire pour modification
function loadPasteurForEdit(pasteurId) {
    // Faire une requÃªte AJAX pour obtenir les donnÃ©es du pasteur
    fetch(`/get_pasteur_details/${pasteurId}/`)
        .then(response => response.json())
        .then(data => {
            // Remplir le formulaire avec les donnÃ©es du pasteur
            document.getElementById('pasteur_id').value = pasteurId;
            document.getElementById('nom').value = data.nom;
            document.getElementById('prenoms').value = data.prenom;
            document.getElementById('fonction').value = data.fonction;
            document.getElementById('sexe').value = data.sexe;
            document.getElementById('date_naissance').value = data.date_naissance;
            document.getElementById('lieu_naissance').value = data.lieu_naissance || '';
            document.getElementById('nationalite').value = data.nationalite || '';
            document.getElementById('domicile').value = data.domicile || '';
            document.getElementById('etat_civil').value = data.etat_civil || '';
            document.getElementById('nombre_enfants').value = data.nombre_enfants || 0;
            document.getElementById('profession').value = data.profession || '';
            document.getElementById('telephone').value = data.telephone || '';
            document.getElementById('email').value = data.email || '';
            document.getElementById('date_consecration').value = data.date_consecration || '';
            
            // Filiations
            document.getElementById('prenoms_pere').value = data.prenoms_pere || '';
            document.getElementById('prenoms_nom_mere').value = data.prenoms_nom_mere || '';
            
            // Affectation
            if (data.eglise_id) {
                document.getElementById('eglise_affectee').value = data.eglise_id;
            }
            document.getElementById('lieu_affectation').value = data.lieu_affectation || '';
            document.getElementById('date_affectation').value = data.date_affectation || '';
            document.getElementById('region').value = data.region || '';
            document.getElementById('zone').value = data.zone || '';
            
            // Formations
            document.getElementById('types_formations').value = data.types_formations || '';
            document.getElementById('statut_actuel').value = data.statut_actuel || '';
            
            // Afficher la photo si disponible
            if (data.photo) {
                const photoPreview = document.getElementById('photoPreview');
                const previewImage = document.getElementById('previewImage');
                const openCameraBtn = document.getElementById('openCameraBtn');
                
                previewImage.src = data.photo;
                photoPreview.style.display = 'block';
                openCameraBtn.style.display = 'none';
            }
            
            // Faire dÃ©filer jusqu'au formulaire
            document.querySelector('.card-header').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Changer le texte du bouton de soumission
            const submitButton = document.querySelector('button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save me-2"></i> Mettre Ã  jour';
        })
        .catch(error => {
            console.error('Erreur lors de la rÃ©cupÃ©ration des donnÃ©es:', error);
            alert('Impossible de rÃ©cupÃ©rer les donnÃ©es du pasteur pour modification.');
        });
}

// Fonction pour confirmer la suppression d'un pasteur
function confirmDeletePasteur(pasteurId) {
    if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer ce pasteur ?')) {
        // Faire une requÃªte AJAX pour supprimer le pasteur
        fetch(`/delete_pasteur/${pasteurId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({ pasteur_id: pasteurId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Supprimer la ligne du tableau
                const row = document.querySelector(`tr[data-id="${pasteurId}"]`);
                if (row) {
                    row.remove();
                    
                    // Mettre Ã  jour le compteur de pasteurs
                    const countBadge = document.getElementById('pasteurCount');
                    if (countBadge) {
                        countBadge.textContent = parseInt(countBadge.textContent) - 1;
                    }
                    
                    // Afficher un message de succÃ¨s
                    const alertContainer = document.getElementById('alertContainer');
                    if (alertContainer) {
                        alertContainer.innerHTML = 
                            '<div class="alert alert-success alert-dismissible fade show" role="alert">' +
                                '<i class="fas fa-check-circle me-2"></i> Le pasteur a Ã©tÃ© supprimÃ© avec succÃ¨s.' +
                                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>' +
                            '</div>';
                    }
                }
                
                // VÃ©rifier si le tableau est vide et ajouter une ligne "aucun rÃ©sultat"
                const rows = document.querySelectorAll('tbody tr:not(#noResultsRow)');
                if (rows.length === 0) {
                    const tbody = document.querySelector('table tbody');
                    if (tbody) {
                        tbody.innerHTML = `
                            <tr id="noResultsRow">
                                <td colspan="8" class="text-center py-4">
                                    <div class="alert alert-info m-0">
                                        <i class="fas fa-info-circle me-2"></i> Aucun personnel pastoral enregistrÃ© pour le moment.
                                    </div>
                                </td>
                            </tr>
                        `;
                    }
                }
            } else {
                alert('Erreur lors de la suppression: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Erreur lors de la suppression:', error);
            alert('Une erreur s\'est produite lors de la suppression du pasteur.');
        });
    }
}

// Fonction pour rÃ©cupÃ©rer les dÃ©tails d'une Ã©glise par son nom
function getEgliseByName(nomEglise) {
    return fetch(`/get_eglise_by_name/?nom=${encodeURIComponent(nomEglise)}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Erreur lors de la rÃ©cupÃ©ration des dÃ©tails de l\'Ã©glise');
            }
            return response.json();
        });
}

// Fonction pour mettre Ã  jour le champ "Ã‰glise affectÃ©e" dans le formulaire du personnel pastoral
function updateEgliseAffectee(nomEglise) {
    console.log('updateEgliseAffectee appelÃ© avec:', nomEglise);
    
    if (!nomEglise || nomEglise.trim() === '') {
        console.log('Nom d\'Ã©glise vide, sortie de la fonction');
        return;
    }
    
    console.log('Appel de getEgliseByName avec:', nomEglise);
    getEgliseByName(nomEglise)
        .then(data => {
            console.log('RÃ©ponse de getEgliseByName:', data);
            if (data.success && data.eglise) {
                const egliseSelect = document.getElementById('eglise_affectee');
                console.log('Element eglise_affectee trouvÃ©:', egliseSelect);
                
                if (egliseSelect) {
                    console.log('Options disponibles:', Array.from(egliseSelect.options).map(opt => opt.text));
                    // Parcourir les options pour trouver celle qui correspond Ã  l'Ã©glise
                    for (let i = 0; i < egliseSelect.options.length; i++) {
                        console.log('Comparaison:', egliseSelect.options[i].text, 'avec', data.eglise.nom);
                        if (egliseSelect.options[i].text === data.eglise.nom) {
                            console.log('Option correspondante trouvÃ©e Ã  l\'index:', i);
                            egliseSelect.selectedIndex = i;
                            break;
                        }
                    }
                } else {
                    console.error('Element eglise_affectee non trouvÃ© dans le DOM');
                }
            } else {
                console.error('DonnÃ©es d\'Ã©glise non valides:', data);
            }
        })
        .catch(error => {
            console.error('Erreur lors de la mise Ã  jour du champ Ã©glise:', error);
        });
}

// VÃ©rifier si une Ã©glise a Ã©tÃ© sÃ©lectionnÃ©e dans le localStorage
document.addEventListener('DOMContentLoaded', function() {
    const selectedEglise = localStorage.getItem('selectedEglise');
    if (selectedEglise) {
        updateEgliseAffectee(selectedEglise);
    }
    
    // Ã‰couter les messages du BroadcastChannel pour les mises Ã  jour en temps rÃ©el
    if (window.BroadcastChannel) {
        const bc = new BroadcastChannel('eglise_channel');
        bc.onmessage = function(event) {
            if (event.data && event.data.egliseNom) {
                updateEgliseAffectee(event.data.egliseNom);
            }
        };
    }
});
</script>

<!-- Modal d'information sur le Personnel Pastoral -->
<div class="modal fade" id="infoPersonnelModal" tabindex="-1" aria-labelledby="infoPersonnelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="infoPersonnelModalLabel"><i class="fas fa-info-circle me-2"></i> Personnel Pastoral</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary"><i class="fas fa-users me-2"></i> Ã‰quipe Pastorale</h5>
                            <p>Gestion complÃ¨te du personnel pastoral de l'Ã‰glise PentecÃ´te AllÃ©luia de GuinÃ©e.</p>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary"><i class="fas fa-praying-hands me-2"></i> Pasteurs Principaux</h5>
                            <p>Direction spirituelle et administrative</p>
                            <ul>
                                <li>Pasteur Principal</li>
                                <li>Pasteurs AssociÃ©s</li>
                                <li>ResponsabilitÃ©s spÃ©cifiques</li>
                                <li>Formations et qualifications</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary"><i class="fas fa-church me-2"></i> MinistÃ¨res SpÃ©cialisÃ©s</h5>
                            <p>Personnel dÃ©diÃ© aux diffÃ©rents ministÃ¨res</p>
                            <ul>
                                <li>MinistÃ¨re de la Jeunesse</li>
                                <li>MinistÃ¨re des Femmes</li>
                                <li>MinistÃ¨re de la Musique</li>
                                <li>MinistÃ¨re d'Ã‰vangÃ©lisation</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary"><i class="fas fa-book-reader me-2"></i> Formation Continue</h5>
                            <p>DÃ©veloppement et formation du personnel</p>
                            <ul>
                                <li>Programmes de formation</li>
                                <li>SÃ©minaires et confÃ©rences</li>
                                <li>Certifications</li>
                                <li>Mentorat</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary"><i class="fas fa-clipboard-list me-2"></i> Gestion Administrative</h5>
                            <p>Dossiers Personnel : Informations complÃ¨tes de chaque membre du personnel<br>
                            Planification : Horaires de service et responsabilitÃ©s<br>
                            Ã‰valuation : Suivi des performances et dÃ©veloppement<br>
                            Coordination : Communication et collaboration entre Ã©quipes</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Enregistrement Personnel Pastoral -->
<!-- Modal de dÃ©tails du pasteur (sera crÃ©Ã© dynamiquement) -->
<div id="pasteurDetailsModalContainer"></div>

<!-- Modal d'enregistrement du personnel pastoral (non utilisÃ© - le formulaire est maintenant intÃ©grÃ© directement dans la page) -->
<!-- <div class="modal fade" id="personnelPastoralModal" tabindex="-1" aria-labelledby="personnelPastoralModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false"> -->
<!-- Tout le contenu du modal a Ã©tÃ© supprimÃ© car le formulaire est maintenant intÃ©grÃ© directement dans la page -->
<!-- </div> -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="quitterFormulaireBtn">
                    <i class="fas fa-sign-out-alt"></i> Quitter le formulaire
                </button>
                <button type="submit" form="personnelForm" class="btn btn-primary">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
            </div>
        </div>
    </div>
</div>



<!-- Styles CSS pour le formulaire -->
<style>
/* Animation de pulsation pour le message de succÃ¨s */
@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.03); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

.pulse-animation {
    animation: pulse 1.5s infinite ease-in-out;
}

.form-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

.section-title {
    color: #007bff;
    margin-bottom: 20px;
    font-weight: 600;
}

.section-title i {
    margin-right: 10px;
}

.modal-xl {
    max-width: 1200px;
}

.form-label {
    font-weight: 500;
    color: #495057;
}

.form-control:focus,
.form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}

.alert-info {
    background-color: #d1ecf1;
    border-color: #bee5eb;
    color: #0c5460;
}

/* Styles pour la camÃ©ra et photo */
.photo-section {
    border: 2px dashed #dee2e6;
    padding: 15px;
    border-radius: 8px;
    background-color: #f8f9fa;
}

.camera-interface {
    text-align: center;
    background: #000;
    border-radius: 8px;
    padding: 10px;
}

.camera-video {
    width: 100%;
    max-width: 300px;
    height: auto;
    border-radius: 8px;
    background: #000;
}

.camera-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
}

.photo-preview {
    text-align: center;
}

.photo-preview img {
    max-width: 200px;
    max-height: 200px;
    border-radius: 8px;
}

.btn-sm {
    font-size: 0.875rem;
    padding: 0.375rem 0.75rem;
}

.gap-2 {
    gap: 0.5rem;
}

.form-section {
    background-color: #fff;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    margin-bottom: 1.5rem;
    overflow: hidden;
}

.form-section-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    padding: 0.75rem 1rem;
}

.form-section-body {
    padding: 1rem;
}

.required-field::after {
    content: " *";
    color: red;
}

.invalid-feedback {
    display: none;
    color: #dc3545;
    font-size: 80%;
}

.was-validated .form-control:invalid ~ .invalid-feedback {
    display: block;
}

.was-validated .form-control:invalid {
    border-color: #dc3545;
}

.camera-interface {
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
    overflow: hidden;
    margin-bottom: 1rem;
}

.camera-video {
    width: 100%;
    height: auto;
    display: block;
}

.camera-controls {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem;
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
}

.photo-preview {
    text-align: center;
    margin-bottom: 1rem;
}

.photo-preview img {
    max-width: 100%;
    max-height: 200px;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
}

.gap-2 {
    gap: 0.5rem;
}

/* Styles pour le tableau du personnel pastoral */
.table-responsive {
    position: relative;
}

.table-hover tbody tr:hover {
    background-color: rgba(13, 110, 253, 0.05);
}

.table-striped > tbody > tr:nth-of-type(odd) > * {
    background-color: rgba(0, 0, 0, 0.02);
}

.table th {
    position: sticky;
    top: 0;
    background-color: #f8f9fa;
    z-index: 10;
    white-space: nowrap;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
}

.table td {
    vertical-align: middle;
    white-space: nowrap;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.table-controls {
    position: sticky;
    left: 0;
    z-index: 20;
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.table-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
}

/* Styles pour les nouveaux boutons photo */
.photo-section .card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.photo-section .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.photo-section .card:hover .fas {
    transform: scale(1.1);
}

.photo-section .btn:hover {
    transform: translateY(-1px);
}


/* Styles pour les boutons d'action */
.btn-group .btn {
    padding: 0.25rem 0.5rem;
    margin: 0 2px;
}

/* Styles pour les colonnes fixes */
.table th:first-child,
.table td:first-child {
    position: sticky;
    left: 0;
    z-index: 15;
    background-color: #fff;
}

.table th:last-child,
.table td:last-child {
    position: sticky;
    right: 0;
    z-index: 15;
    background-color: #fff;
}

/* Styles pour les lignes survolÃ©es avec colonnes fixes */
.table-hover tbody tr:hover td:first-child,
.table-hover tbody tr:hover td:last-child {
    background-color: rgba(0, 0, 0, 0.075);
}

/* Animation pour mettre en Ã©vidence le tableau */
@keyframes tableHighlight {
    0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
    20% { box-shadow: 0 0 20px 10px rgba(255, 193, 7, 0.5); }
    100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}

.table-highlight-animation {
    animation: tableHighlight 2s ease-in-out;
}

.table-striped > tbody > tr:nth-of-type(odd) > td:first-child,
.table-striped > tbody > tr:nth-of-type(odd) > td:last-child {
    background-color: rgba(0, 0, 0, 0.02);
}
</style>

<!-- JavaScript pour la camÃ©ra -->
<script>
// Fonctions simplifiÃ©es pour les boutons photo
function openCamera() {
    console.log('=== OUVERTURE CAMERA ===');
    
    // VÃ©rifier si le navigateur supporte getUserMedia
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showCameraError('Votre navigateur ne supporte pas l\'accÃ¨s Ã  la camÃ©ra.', 'BROWSER_NOT_SUPPORTED');
        return;
    }
    
    // VÃ©rifier le contexte sÃ©curisÃ© (HTTPS ou localhost)
    const isSecureContext = window.isSecureContext || 
                           location.protocol === 'https:' || 
                           location.hostname === 'localhost' || 
                           location.hostname === '127.0.0.1' ||
                           location.hostname === '::1';
    
    if (!isSecureContext) {
        showCameraError('L\'accÃ¨s Ã  la camÃ©ra nÃ©cessite une connexion sÃ©curisÃ©e (HTTPS).', 'INSECURE_CONTEXT');
        return;
    }
    
    console.log('Tentative d\'accÃ¨s Ã  la camÃ©ra...');
    
    // Masquer l'interface principale photo avant d'ouvrir la camÃ©ra
    const photoMainInterface = document.getElementById('photoMainInterface');
    if (photoMainInterface) {
        photoMainInterface.style.display = 'none';
    }
    
    navigator.mediaDevices.getUserMedia({ 
        video: { 
            width: { ideal: 640 }, 
            height: { ideal: 480 },
            facingMode: 'user'
        } 
    })
    .then(function(stream) {
        console.log('Flux camÃ©ra obtenu avec succÃ¨s');
        
        const video = document.getElementById('cameraVideo');
        const cameraInterface = document.getElementById('cameraInterface');
        
        if (video && cameraInterface) {
            video.srcObject = stream;
            video.play();
            cameraInterface.style.display = 'block';
            window.currentStream = stream;
            
            console.log('Interface camÃ©ra affichÃ©e');
        } else {
            console.error('Ã‰lÃ©ments vidÃ©o ou interface camÃ©ra non trouvÃ©s');
            showCameraError('Erreur d\'affichage de la camÃ©ra.', 'DISPLAY_ERROR');
            // RÃ©afficher l'interface principale en cas d'erreur
            const photoMainInterface = document.getElementById('photoMainInterface');
            if (photoMainInterface) {
                photoMainInterface.style.display = 'block';
            }
        }
    })
    .catch(function(error) {
        console.error('Erreur d\'accÃ¨s Ã  la camÃ©ra:', error);
        
        // RÃ©afficher l'interface principale en cas d'erreur
        const photoMainInterface = document.getElementById('photoMainInterface');
        if (photoMainInterface) {
            photoMainInterface.style.display = 'block';
        }
        
        let errorType = 'UNKNOWN_ERROR';
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
            errorType = 'PERMISSION_DENIED';
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
            errorType = 'NO_CAMERA';
        } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
            errorType = 'CAMERA_BUSY';
        } else if (error.name === 'OverconstrainedError' || error.name === 'ConstraintNotSatisfiedError') {
            errorType = 'CONSTRAINTS_ERROR';
        }
        
        showCameraError(error.message, errorType);
    });
}

// Fonction pour afficher les erreurs de camÃ©ra avec solutions
function showCameraError(message, errorType) {
    console.log('Erreur camÃ©ra:', errorType, message);
    
    let instructions = '';
    let title = 'ProblÃ¨me d\'accÃ¨s Ã  la camÃ©ra';
    
    switch(errorType) {
        case 'PERMISSION_DENIED':
            title = 'Autorisation camÃ©ra refusÃ©e';
            instructions = `SOLUTIONS POUR DÃ‰BLOQUER LA CAMÃ‰RA:\n\n1. Cliquez sur l'icÃ´ne ðŸ”’ ou ðŸŽ¥ dans la barre d'adresse\n2. Changez "CamÃ©ra" de "Bloquer" Ã  "Autoriser"\n3. Rechargez la page et rÃ©essayez\n\nOU dans les paramÃ¨tres du navigateur:\n1. Allez dans ParamÃ¨tres > ConfidentialitÃ© > CamÃ©ra\n2. Ajoutez ce site Ã  la liste des sites autorisÃ©s`;
            break;
        case 'NO_CAMERA':
            title = 'Aucune camÃ©ra dÃ©tectÃ©e';
            instructions = `Aucune camÃ©ra n'a Ã©tÃ© trouvÃ©e sur cet appareil.\n\nVÃ©rifiez que votre camÃ©ra est bien connectÃ©e et fonctionnelle.`;
            break;
        case 'CAMERA_BUSY':
            title = 'CamÃ©ra occupÃ©e';
            instructions = `La camÃ©ra est utilisÃ©e par une autre application.\n\nFermez les autres applications utilisant la camÃ©ra et rÃ©essayez.`;
            break;
        case 'BROWSER_NOT_SUPPORTED':
            title = 'Navigateur non supportÃ©';
            instructions = `Votre navigateur ne supporte pas l'accÃ¨s Ã  la camÃ©ra.\n\nUtilisez Chrome, Firefox, Edge ou Safari rÃ©cent.`;
            break;
        case 'INSECURE_CONTEXT':
            title = 'Connexion non sÃ©curisÃ©e';
            instructions = `L'accÃ¨s Ã  la camÃ©ra nÃ©cessite HTTPS ou localhost.\n\nEssayez d'accÃ©der via:\n- https://127.0.0.1:8000/\n- ou utilisez localhost au lieu de 127.0.0.1`;
            break;
        case 'CONSTRAINTS_ERROR':
            title = 'ParamÃ¨tres camÃ©ra incompatibles';
            instructions = `Les paramÃ¨tres demandÃ©s ne sont pas supportÃ©s par votre camÃ©ra.`;
            break;
        case 'DISPLAY_ERROR':
            title = 'Erreur d\'affichage de la camÃ©ra';
            instructions = `Erreur technique lors de l'affichage de la camÃ©ra.`;
            break;
        default:
            instructions = `Erreur technique inattendue.\n\nDÃ©tails: ${message}`;
    }
    
    instructions += `\n\nðŸ’¡ ALTERNATIVE: Vous pouvez importer une photo depuis vos fichiers.`;
    
    // Afficher le message avec les instructions
    if (confirm(title + '\n\n' + instructions + '\n\nVoulez-vous ouvrir le sÃ©lecteur de fichiers Ã  la place?')) {
        importImage();
    }
}

function capturePhoto() {
    console.log('=== CAPTURE PHOTO ===');
    
    const video = document.getElementById('cameraVideo');
    const canvas = document.getElementById('cameraCanvas');
    const previewImage = document.getElementById('previewImage');
    const photoPreview = document.getElementById('photoPreview');
    const photoInput = document.getElementById('photo');
    
    if (video && canvas && previewImage && photoPreview) {
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // Dessiner l'image de la vidÃ©o sur le canvas
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // Convertir en base64
        const dataURL = canvas.toDataURL('image/jpeg', 0.8);
        
        // Convertir dataURL en File pour l'input
        canvas.toBlob(function(blob) {
            const file = new File([blob], 'photo_capture.jpg', { type: 'image/jpeg' });
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(file);
            photoInput.files = dataTransfer.files;
        }, 'image/jpeg', 0.8);
        
        // Afficher la prÃ©visualisation
        previewImage.src = dataURL;
        photoPreview.style.display = 'block';
        
        // Masquer l'interface camÃ©ra et l'interface principale
        const cameraInterface = document.getElementById('cameraInterface');
        const photoMainInterface = document.getElementById('photoMainInterface');
        if (cameraInterface) cameraInterface.style.display = 'none';
        if (photoMainInterface) photoMainInterface.style.display = 'none';
        
        // Fermer la camÃ©ra
        closeCamera();
        
        console.log('Photo capturÃ©e avec succÃ¨s');
    } else {
        console.error('Ã‰lÃ©ments requis pour la capture non trouvÃ©s');
        alert('Erreur lors de la capture de la photo.');
    }
}

function importImage() {
    console.log('=== IMPORT IMAGE ===');
    
    const photoInput = document.getElementById('photo');
    if (photoInput) {
        photoInput.click();
    } else {
        alert('Erreur: Impossible d\'ouvrir le sÃ©lecteur de fichiers.');
    }
}

function closeCamera() {
    console.log('=== FERMETURE CAMERA ===');
    
    // ArrÃªter le flux vidÃ©o
    if (window.currentStream) {
        window.currentStream.getTracks().forEach(track => {
            track.stop();
            console.log('Track arrÃªtÃ©:', track.kind);
        });
        window.currentStream = null;
    }
    
    // Masquer l'interface camÃ©ra
    const cameraInterface = document.getElementById('cameraInterface');
    if (cameraInterface) {
        cameraInterface.style.display = 'none';
    }
    
    // RÃ©afficher l'interface principale photo
    const photoMainInterface = document.getElementById('photoMainInterface');
    if (photoMainInterface) {
        photoMainInterface.style.display = 'block';
    }
    
    console.log('CamÃ©ra fermÃ©e avec succÃ¨s');
}

function clearPhoto() {
    console.log('=== SUPPRESSION PHOTO ===');
    
    const photoInput = document.getElementById('photo');
    const photoPreview = document.getElementById('photoPreview');
    const previewImage = document.getElementById('previewImage');
    const photoMainInterface = document.getElementById('photoMainInterface');
    
    if (photoInput) photoInput.value = '';
    if (photoPreview) photoPreview.style.display = 'none';
    if (previewImage) previewImage.src = '';
    
    // RÃ©afficher l'interface principale photo
    if (photoMainInterface) {
        photoMainInterface.style.display = 'block';
    }
    
    console.log('Photo supprimÃ©e, interface principale rÃ©affichÃ©e');
}

// Event listeners pour les boutons photo
document.addEventListener('DOMContentLoaded', function() {
    // Bouton principal Photo
    const photoMainBtn = document.getElementById('photoMainBtn');
    if (photoMainBtn) {
        photoMainBtn.addEventListener('click', function() {
            // Afficher le menu des options photo
            const photoMainInterface = document.getElementById('photoMainInterface');
            const cameraInterface = document.getElementById('cameraInterface');
            
            // CrÃ©er un menu contextuel ou ouvrir directement la camÃ©ra
            openCamera();
        });
    }
    
    // Bouton camÃ©ra
    const cameraBtn = document.getElementById('cameraBtn');
    if (cameraBtn) {
        cameraBtn.addEventListener('click', function() {
            openCamera();
            // Masquer l'interface principale
            const photoMainInterface = document.getElementById('photoMainInterface');
            if (photoMainInterface) {
                photoMainInterface.style.display = 'none';
            }
        });
    }
    
    // Bouton import
    const importBtn = document.getElementById('importBtn');
    if (importBtn) {
        importBtn.addEventListener('click', function() {
            importImage();
        });
    }
    
    // Bouton capture
    const captureBtn = document.getElementById('captureBtn');
    if (captureBtn) {
        captureBtn.addEventListener('click', capturePhoto);
    }
    
    // Bouton fermer camÃ©ra
    const closeCameraBtn = document.getElementById('closeCameraBtn');
    if (closeCameraBtn) {
        closeCameraBtn.addEventListener('click', closeCamera);
    }
    
    // Bouton supprimer photo
    const clearPhotoBtn = document.getElementById('clearPhotoBtn');
    if (clearPhotoBtn) {
        clearPhotoBtn.addEventListener('click', clearPhoto);
    }
    
    // Bouton changer photo
    const changePhotoBtn = document.getElementById('changePhotoBtn');
    if (changePhotoBtn) {
        changePhotoBtn.addEventListener('click', function() {
            // Masquer la prÃ©visualisation
            const photoPreview = document.getElementById('photoPreview');
            if (photoPreview) {
                photoPreview.style.display = 'none';
            }
            
            // RÃ©afficher l'interface principale
            const photoMainInterface = document.getElementById('photoMainInterface');
            if (photoMainInterface) {
                photoMainInterface.style.display = 'block';
            }
            
            console.log('Retour Ã  l\'interface principale photo');
        });
    }
    
    // Event listener pour l'input file
    const photoInput = document.getElementById('photo');
    if (photoInput) {
        photoInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImage = document.getElementById('previewImage');
                    const photoPreview = document.getElementById('photoPreview');
                    const photoMainInterface = document.getElementById('photoMainInterface');
                    
                    if (previewImage && photoPreview) {
                        previewImage.src = e.target.result;
                        photoPreview.style.display = 'block';
                        
                        // Masquer l'interface principale photo
                        if (photoMainInterface) {
                            photoMainInterface.style.display = 'none';
                        }
                        
                        console.log('Image importÃ©e avec succÃ¨s');
                    }
                };
                reader.readAsDataURL(file);
            }
        });
    }
});

// Fin du script photo simplifiÃ©

// Fonction de validation des champs obligatoires
function validateForm() {
    console.log('=== VALIDATION DES CHAMPS OBLIGATOIRES ===');
    
    // DÃ©sactiver la validation cÃ´tÃ© client - laisser Django gÃ©rer la validation
    console.log('Validation dÃ©sactivÃ©e - soumission du formulaire autorisÃ©e');
    return true;
    
    // Code de validation commentÃ© pour rÃ©fÃ©rence future
    /*
    // Liste des champs obligatoires avec leurs IDs et noms d'affichage
    const requiredFields = [
        { id: 'prenoms', name: 'PrÃ©noms' },
        { id: 'nom', name: 'Nom' },
        { id: 'fonction', name: 'Fonction' },
        { id: 'sexe', name: 'Sexe' },
        { id: 'date_naissance', name: 'Date de naissance' },
        { id: 'telephone', name: 'TÃ©lÃ©phone' },
        { id: 'eglise_affectee', name: 'Ã‰glise affectÃ©e' }
    ];
    
    let isValid = true;
    let emptyFields = [];
    
    // VÃ©rifier chaque champ obligatoire
    requiredFields.forEach(function(field) {
        const element = document.getElementById(field.id);
        if (!element) {
            console.error(`Champ ${field.id} non trouvÃ©!`);
            return;
        }
        
        const fieldValue = element.value ? element.value.trim() : '';
        console.log(`VÃ©rification ${field.name}:`, fieldValue ? 'REMPLI' : 'VIDE');
        
        if (!fieldValue) {
            isValid = false;
            emptyFields.push(field.name);
            // Mettre en Ã©vidence le champ vide
            element.classList.add('is-invalid');
            element.style.border = '2px solid #dc3545';
            element.style.boxShadow = '0 0 5px rgba(220, 53, 69, 0.5)';
        } else {
            // Retirer la mise en Ã©vidence si le champ est rempli
            element.classList.remove('is-invalid');
            element.style.border = '';
            element.style.boxShadow = '';
        }
    });
    */
    
    // Masquer tous les messages de validation
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    
    if (successMessage) successMessage.style.display = 'none';
    if (errorMessage) errorMessage.style.display = 'none';
    
    // Retourner true pour permettre la soumission du formulaire
    console.log('Formulaire validÃ© - soumission autorisÃ©e');
    return true;
    
    /*
    // Code de validation d'erreur commentÃ© pour rÃ©fÃ©rence future
    if (errorMessage) {
        if (!isValid) {
            errorMessage.style.display = 'block';
            errorMessage.innerHTML = `<i class="fas fa-exclamation-triangle me-2"></i> Veuillez remplir les champs obligatoires suivants : <strong>${emptyFields.join(', ')}</strong>`;
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            console.log('VALIDATION Ã‰CHOUÃ‰E - Champs manquants:', emptyFields);
            return false; // EmpÃªcher la soumission du formulaire
        } else {
            errorMessage.style.display = 'none';
            
            // Afficher le message de succÃ¨s
            if (successMessage) {
                successMessage.style.display = 'block';
                successMessage.innerHTML = '<i class="fas fa-check-circle me-2 fa-lg"></i> Tous les champs obligatoires sont remplis. Enregistrement en cours...';
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            console.log('VALIDATION RÃ‰USSIE - Formulaire peut Ãªtre soumis');
            return true; // Permettre la soumission du formulaire
        }
    }
    
    return isValid;
    */
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialisation directe et simple des boutons photo
    console.log('=== INITIALISATION PHOTO SIMPLIFIÃ‰E ===');
    
    // RÃ©cupÃ©rer les Ã©lÃ©ments
    const openCameraBtn = document.getElementById('openCameraBtn');
    const importImageBtn = document.getElementById('importImageBtn');
    const photoInput = document.getElementById('photoInput');
    const cameraInterface = document.getElementById('cameraInterface');
    const cameraVideo = document.getElementById('cameraVideo');
    const captureBtn = document.getElementById('captureBtn');
    const closeCameraBtn = document.getElementById('closeCameraBtn');
    const photoMainInterface = document.getElementById('photoMainInterface');
    const photoPreview = document.getElementById('photoPreview');
    const previewImage = document.getElementById('previewImage');
    const changePhotoBtn = document.getElementById('changePhotoBtn');
    const clearPhotoBtn = document.getElementById('clearPhotoBtn');
    const cameraCanvas = document.getElementById('cameraCanvas');
    
    let currentStream = null;
    
    console.log('Ã‰lÃ©ments trouvÃ©s:', {
        openCameraBtn: !!openCameraBtn,
        importImageBtn: !!importImageBtn,
        cameraInterface: !!cameraInterface,
        cameraVideo: !!cameraVideo
    });
    
    // Bouton CamÃ©ra
    if (openCameraBtn) {
        openCameraBtn.addEventListener('click', function() {
            console.log('ðŸŽ¥ Bouton CamÃ©ra cliquÃ©');
            activerCamera();
        });
    }
    
    // Bouton Importer
    if (importImageBtn) {
        importImageBtn.addEventListener('click', function() {
            console.log('ðŸ“ Bouton Importer cliquÃ©');
            if (photoInput) {
                photoInput.click();
            }
        });
    }
    
    // Fonction pour activer la camÃ©ra
    function activerCamera() {
        console.log('ðŸŽ¬ Activation de la camÃ©ra...');
        
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            alert('âŒ Votre navigateur ne supporte pas l\'accÃ¨s Ã  la camÃ©ra.');
            return;
        }
        
        // Masquer l'interface principale
        if (photoMainInterface) {
            photoMainInterface.style.display = 'none';
        }
        
        // Afficher l'interface camÃ©ra
        if (cameraInterface) {
            cameraInterface.style.display = 'block';
        }
        
        // Demander l'accÃ¨s Ã  la camÃ©ra
        navigator.mediaDevices.getUserMedia({ 
            video: { 
                width: { ideal: 640 }, 
                height: { ideal: 480 },
                facingMode: 'user'
            } 
        })
        .then(function(stream) {
            console.log('âœ… CamÃ©ra activÃ©e avec succÃ¨s');
            currentStream = stream;
            if (cameraVideo) {
                cameraVideo.srcObject = stream;
                cameraVideo.play();
            }
        })
        .catch(function(error) {
            console.error('âŒ Erreur camÃ©ra:', error);
            let message = 'Impossible d\'activer la camÃ©ra. ';
            
            if (error.name === 'NotAllowedError') {
                message += 'Veuillez autoriser l\'accÃ¨s Ã  la camÃ©ra.';
            } else if (error.name === 'NotFoundError') {
                message += 'Aucune camÃ©ra dÃ©tectÃ©e.';
            } else {
                message += 'Erreur: ' + error.message;
            }
            
            alert(message);
            
            // Revenir Ã  l'interface principale
            if (cameraInterface) cameraInterface.style.display = 'none';
            if (photoMainInterface) photoMainInterface.style.display = 'block';
        });
    }
    
    // Bouton Capturer
    if (captureBtn) {
        captureBtn.addEventListener('click', function() {
            console.log('ðŸ“¸ Capture photo');
            capturerPhoto();
        });
    }
    
    // Bouton Fermer camÃ©ra
    if (closeCameraBtn) {
        closeCameraBtn.addEventListener('click', function() {
            console.log('âŒ Fermeture camÃ©ra');
            fermerCamera();
        });
    }
    
    // Fonction pour capturer la photo
    function capturerPhoto() {
        if (!cameraVideo || !cameraCanvas) return;
        
        const canvas = cameraCanvas;
        const context = canvas.getContext('2d');
        
        canvas.width = cameraVideo.videoWidth;
        canvas.height = cameraVideo.videoHeight;
        
        context.drawImage(cameraVideo, 0, 0);
        
        // Convertir en blob et afficher la prÃ©visualisation
        canvas.toBlob(function(blob) {
            const url = URL.createObjectURL(blob);
            
            if (previewImage) {
                previewImage.src = url;
            }
            
            // Masquer la camÃ©ra et afficher la prÃ©visualisation
            if (cameraInterface) cameraInterface.style.display = 'none';
            if (photoPreview) photoPreview.style.display = 'block';
            
            // ArrÃªter la camÃ©ra
            fermerCamera();
            
            console.log('âœ… Photo capturÃ©e et affichÃ©e');
        });
    }
    
    // Fonction pour fermer la camÃ©ra
    function fermerCamera() {
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            currentStream = null;
        }
        
        if (cameraInterface) cameraInterface.style.display = 'none';
        if (photoMainInterface) photoMainInterface.style.display = 'block';
        
        console.log('ðŸ”´ CamÃ©ra fermÃ©e');
    }
    
    // Gestion de l'import de fichier
    if (photoInput) {
        photoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                console.log('ðŸ“ Fichier sÃ©lectionnÃ©:', file.name);
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    if (previewImage) {
                        previewImage.src = event.target.result;
                    }
                    
                    // Masquer l'interface principale et afficher la prÃ©visualisation
                    if (photoMainInterface) photoMainInterface.style.display = 'none';
                    if (photoPreview) photoPreview.style.display = 'block';
                    
                    console.log('âœ… Image importÃ©e et affichÃ©e');
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Bouton Changer photo
    if (changePhotoBtn) {
        changePhotoBtn.addEventListener('click', function() {
            if (photoPreview) photoPreview.style.display = 'none';
            if (photoMainInterface) photoMainInterface.style.display = 'block';
        });
    }
    
    // Bouton Supprimer photo
    if (clearPhotoBtn) {
        clearPhotoBtn.addEventListener('click', function() {
            if (previewImage) previewImage.src = '';
            if (photoInput) photoInput.value = '';
            if (photoPreview) photoPreview.style.display = 'none';
            if (photoMainInterface) photoMainInterface.style.display = 'block';
            console.log('ðŸ—‘ï¸ Photo supprimÃ©e');
        });
    }

    
    // Gestion des messages de succÃ¨s et d'erreur
    const alerts = document.querySelectorAll('.alert');
    
    alerts.forEach(function(alert) {
        // Animation d'entrÃ©e
        alert.style.opacity = '0';
        alert.style.transform = 'translateY(-20px)';
        alert.style.transition = 'all 0.5s ease-in-out';
        
        // Afficher avec animation
        setTimeout(function() {
            alert.style.opacity = '1';
            alert.style.transform = 'translateY(0)';
        }, 100);
        
        // Auto-masquage aprÃ¨s 8 secondes pour les messages de succÃ¨s
        if (alert.classList.contains('alert-success')) {
            setTimeout(function() {
                if (alert && alert.parentNode) {
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateY(-20px)';
                    setTimeout(function() {
                        if (alert && alert.parentNode) {
                            alert.remove();
                        }
                    }, 500);
                }
            }, 8000); // 8 secondes
        }
        
        // Auto-masquage aprÃ¨s 12 secondes pour les messages d'erreur
        if (alert.classList.contains('alert-danger')) {
            setTimeout(function() {
                if (alert && alert.parentNode) {
                    alert.style.opacity = '0';
                    alert.style.transform = 'translateY(-20px)';
                    setTimeout(function() {
                        if (alert && alert.parentNode) {
                            alert.remove();
                        }
                    }, 500);
                }
            }, 12000); // 12 secondes
        }
        
        // Effet de survol
        alert.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(0) scale(1.02)';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
        });
        
        alert.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
            this.style.boxShadow = '';
        });
    });
    
    // Fonction pour afficher un message de succÃ¨s personnalisÃ©
    window.showSuccessMessage = function(message) {
        const alertHtml = `
            <div class="alert alert-success alert-dismissible fade show" role="alert" style="border-left: 5px solid #28a745; background-color: #d4edda; border-color: #c3e6cb; opacity: 0; transform: translateY(-20px); transition: all 0.5s ease-in-out;">
                <div class="d-flex align-items-center">
                    <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                    <div>
                        <h5 class="alert-heading mb-1"><strong>SuccÃ¨s !</strong></h5>
                        <p class="mb-0">${message}</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        
        const container = document.querySelector('.container .row .col-12');
        const messagesDiv = document.querySelector('.mb-4') || container;
        messagesDiv.insertAdjacentHTML('afterbegin', alertHtml);
        
        const newAlert = messagesDiv.querySelector('.alert');
        setTimeout(function() {
            newAlert.style.opacity = '1';
            newAlert.style.transform = 'translateY(0)';
        }, 100);
    };
    
    // Fonction pour afficher un message d'erreur personnalisÃ©
    window.showErrorMessage = function(message) {
        const alertHtml = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert" style="border-left: 5px solid #dc3545; background-color: #f8d7da; border-color: #f5c6cb; opacity: 0; transform: translateY(-20px); transition: all 0.5s ease-in-out;">
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger me-3"></i>
                    <div>
                        <h5 class="alert-heading mb-1"><strong>Erreur</strong></h5>
                        <p class="mb-0">${message}</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        
        const container = document.querySelector('.container .row .col-12');
        const messagesDiv = document.querySelector('.mb-4') || container;
        messagesDiv.insertAdjacentHTML('afterbegin', alertHtml);
        
        const newAlert = messagesDiv.querySelector('.alert');
        setTimeout(function() {
            newAlert.style.opacity = '1';
            newAlert.style.transform = 'translateY(0)';
        }, 100);
    };

});

</script>

{% endblock %}
        });
    }
    
    // Gestionnaire pour le bouton "Enregistrer"
    if (submitFormBtn) {
        submitFormBtn.addEventListener('click', function() {
            console.log('Tentative de soumission du formulaire');
            
            // Masquer les messages prÃ©cÃ©dents
            if (formErrorMessage) formErrorMessage.classList.add('d-none');
            if (formSuccessMessage) formSuccessMessage.classList.add('d-none');
            
            // Valider le formulaire
            if (!validateForm()) {
                console.log('Validation Ã©chouÃ©e');
                if (formErrorMessage) {
                    formErrorMessage.classList.remove('d-none');
                    formErrorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }
            
            console.log('Validation rÃ©ussie');
            
            // Simuler l'enregistrement (Ã  remplacer par un appel AJAX rÃ©el)
            setTimeout(() => {
                if (formSuccessMessage) {
                    formSuccessMessage.classList.remove('d-none');
                    formSuccessMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                
                // RÃ©initialiser le formulaire aprÃ¨s 2 secondes
                setTimeout(() => {
                    resetForm();
                    
                    // Fermer le modal
                    const modal = bootstrap.Modal.getInstance(personnelFormModal);
                    if (modal) {
                        modal.hide();
                    }
                }, 2000);
            }, 500);
        });
    }
    
    // Gestionnaire pour la fermeture du modal (rÃ©initialisation)
    if (personnelFormModal) {
        personnelFormModal.addEventListener('hidden.bs.modal', function() {
            resetForm();
        });
    }
    
    // Validation en temps rÃ©el des champs obligatoires
    if (personnelForm) {
        const requiredFields = personnelForm.querySelectorAll('[required]');
        requiredFields.forEach(field => {
            field.addEventListener('blur', function() {
                if (this.value.trim()) {
                    this.style.border = '';
                    this.style.boxShadow = '';
                } else {
                    this.style.border = '2px solid #dc3545';
                    this.style.boxShadow = '0 0 5px rgba(220, 53, 69, 0.5)';
                }
            });
            
            field.addEventListener('input', function() {
                if (this.value.trim()) {
                    this.style.border = '';
                    this.style.boxShadow = '';
                }
            });
        });
    }
    
    // FonctionnalitÃ©s pour le tableau du personnel pastoral
    const tablePageSize = document.getElementById('tablePageSize');
    const toggleColumnsBtn = document.getElementById('toggleColumnsBtn');
    const exportTableBtn = document.getElementById('exportTableBtn');
    const printTableBtn = document.getElementById('printTableBtn');
    const fixedHeadersSwitch = document.getElementById('fixedHeadersSwitch');
    
    // Pagination
    const firstPageBtn = document.getElementById('firstPageBtn');
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    const lastPageBtn = document.getElementById('lastPageBtn');
    const currentPageSpan = document.getElementById('currentPage');
    const totalPagesSpan = document.getElementById('totalPages');
    const startRecordSpan = document.getElementById('startRecord');
    const endRecordSpan = document.getElementById('endRecord');
    const totalRecordsSpan = document.getElementById('totalRecords');
    
    // Variables de pagination
    let currentPage = 1;
    let pageSize = 2; // Afficher 2 lignes par dÃ©faut
    let totalPages = 1;
    let totalRecords = 0;
    
    // Fonction pour initialiser la pagination
    function initPagination() {
        const table = document.querySelector('.table');
        if (!table) return;
        
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        totalRecords = rows.length;
        
        // Mettre Ã  jour les compteurs
        totalRecordsSpan.textContent = totalRecords;
        
        // Calculer le nombre total de pages
        pageSize = parseInt(tablePageSize.value);
        if (pageSize === -1) {
            totalPages = 1;
            currentPage = 1;
        } else {
            totalPages = Math.ceil(totalRecords / pageSize);
            if (currentPage > totalPages) currentPage = totalPages;
            if (currentPage < 1) currentPage = 1;
        }
        
        // Mettre Ã  jour l'affichage de la pagination
        updatePaginationDisplay();
        
        // Afficher les lignes de la page courante
        showCurrentPage();
    }
    
    // Fonction pour mettre Ã  jour l'affichage de la pagination
    function updatePaginationDisplay() {
        totalPagesSpan.textContent = totalPages;
        currentPageSpan.textContent = currentPage;
        
        // Activer/dÃ©sactiver les boutons de navigation
        firstPageBtn.disabled = (currentPage === 1);
        prevPageBtn.disabled = (currentPage === 1);
        nextPageBtn.disabled = (currentPage === totalPages || totalPages === 0);
        lastPageBtn.disabled = (currentPage === totalPages || totalPages === 0);
        
        // Mettre Ã  jour les compteurs d'enregistrements
        if (totalRecords === 0) {
            startRecordSpan.textContent = '0';
            endRecordSpan.textContent = '0';
        } else if (pageSize === -1) {
            startRecordSpan.textContent = '1';
            endRecordSpan.textContent = totalRecords;
        } else {
            const start = (currentPage - 1) * pageSize + 1;
            const end = Math.min(start + pageSize - 1, totalRecords);
            startRecordSpan.textContent = start;
            endRecordSpan.textContent = end;
        }
    }
    
    // Fonction pour afficher les lignes de la page courante
    function showCurrentPage() {
        const table = document.querySelector('.table');
        if (!table) return;
        
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        
        if (pageSize === -1) {
            // Afficher toutes les lignes
            rows.forEach(row => {
                row.style.display = '';
            });
        } else {
            // Calculer les indices de dÃ©but et de fin
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, rows.length);
            
            // Masquer toutes les lignes
            rows.forEach(row => {
                row.style.display = 'none';
            });
            
            // Afficher les lignes de la page courante
            for (let i = startIndex; i < endIndex; i++) {
                if (rows[i]) rows[i].style.display = '';
            }
        }
    }
    
    // Fonction pour exporter le tableau en CSV
    function exportTableToCSV() {
        const table = document.querySelector('.table');
        if (!table) return;
        
        const rows = Array.from(table.querySelectorAll('tr'));
        let csv = [];
        
        rows.forEach(row => {
            const cols = Array.from(row.querySelectorAll('th, td'));
            const rowData = cols.map(col => {
                // RÃ©cupÃ©rer le texte visible (pas les boutons ou images)
                let text = col.innerText.trim();
                // Ã‰chapper les guillemets doubles
                text = text.replace(/"/g, '""');
                // Entourer de guillemets doubles
                return `"${text}"`;
            });
            csv.push(rowData.join(','));
        });
        
        // CrÃ©er un lien de tÃ©lÃ©chargement
        const csvContent = csv.join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', 'personnel_pastoral.csv');
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    // Fonction pour imprimer le tableau
    function printTable() {
        const tableContainer = document.querySelector('.table-responsive');
        if (!tableContainer) return;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Personnel Pastoral - Impression</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
                    <style>
                        body { font-family: Arial, sans-serif; }
                        .table { width: 100%; border-collapse: collapse; }
                        .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .table th { background-color: #f2f2f2; }
                        .table-responsive { overflow: visible; }
                        @media print {
                            .no-print { display: none; }
                            body { padding: 20px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="container-fluid">
                        <h2 class="mb-3">Liste du Personnel Pastoral</h2>
                        <div class="table-responsive">
                            ${tableContainer.innerHTML}
                        </div>
                        <div class="mt-3 no-print">
                            <button class="btn btn-primary" onclick="window.print();return false;">Imprimer</button>
                            <button class="btn btn-secondary" onclick="window.close();return false;">Fermer</button>
                        </div>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
        
        // Supprimer les boutons d'action du tableau imprimÃ©
        const actionCells = printWindow.document.querySelectorAll('.table th:last-child, .table td:last-child');
        actionCells.forEach(cell => {
            cell.style.display = 'none';
        });
        
        printWindow.focus();
    }
    
    // Fonction pour afficher/masquer des colonnes
    function toggleColumns() {
        const table = document.querySelector('.table');
        if (!table) return;
        
        // CrÃ©er un modal pour sÃ©lectionner les colonnes
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.id = 'columnsModal';
        modal.setAttribute('tabindex', '-1');
        modal.setAttribute('aria-labelledby', 'columnsModalLabel');
        modal.setAttribute('aria-hidden', 'true');
        
        const headers = Array.from(table.querySelectorAll('th'));
        let checkboxesHtml = '';
        
        headers.forEach((header, index) => {
            if (index === 0 || index === headers.length - 1) return; // Ignorer la premiÃ¨re et derniÃ¨re colonne (photo et actions)
            
            const headerText = header.textContent.trim();
            const isVisible = header.style.display !== 'none';
            
            checkboxesHtml += `
                <div class="form-check mb-2">
                    <input class="form-check-input column-toggle" type="checkbox" id="column${index}" data-column="${index}" ${isVisible ? 'checked' : ''}>
                    <label class="form-check-label" for="column${index}">
                        ${headerText}
                    </label>
                </div>
            `;
        });
        
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="columnsModalLabel">Afficher/Masquer des colonnes</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                        <div class="d-flex justify-content-between mb-3">
                            <button class="btn btn-sm btn-outline-primary" id="selectAllColumns">Tout sÃ©lectionner</button>
                            <button class="btn btn-sm btn-outline-secondary" id="deselectAllColumns">Tout dÃ©sÃ©lectionner</button>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                ${checkboxesHtml.slice(0, Math.ceil(checkboxesHtml.length / 2))}
                            </div>
                            <div class="col-md-6">
                                ${checkboxesHtml.slice(Math.ceil(checkboxesHtml.length / 2))}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        <button type="button" class="btn btn-primary" id="applyColumnChanges">Appliquer</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Initialiser le modal Bootstrap
        const columnsModal = new bootstrap.Modal(document.getElementById('columnsModal'));
        columnsModal.show();
        
        // GÃ©rer les Ã©vÃ©nements du modal
        document.getElementById('selectAllColumns').addEventListener('click', function() {
            document.querySelectorAll('.column-toggle').forEach(checkbox => {
                checkbox.checked = true;
            });
        });
        
        document.getElementById('deselectAllColumns').addEventListener('click', function() {
            document.querySelectorAll('.column-toggle').forEach(checkbox => {
                checkbox.checked = false;
            });
        });
        
        document.getElementById('applyColumnChanges').addEventListener('click', function() {
            document.querySelectorAll('.column-toggle').forEach(checkbox => {
                const columnIndex = parseInt(checkbox.dataset.column);
                const isVisible = checkbox.checked;
                
                // Appliquer la visibilitÃ© Ã  toutes les cellules de cette colonne
                const cells = table.querySelectorAll(`tr > *:nth-child(${columnIndex + 1})`);
                cells.forEach(cell => {
                    cell.style.display = isVisible ? '' : 'none';
                });
            });
            
            columnsModal.hide();
            
            // Supprimer le modal aprÃ¨s utilisation
            document.getElementById('columnsModal').addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        });
    }
    
    // Ajouter les Ã©couteurs d'Ã©vÃ©nements
    if (tablePageSize) {
        tablePageSize.addEventListener('change', function() {
            pageSize = parseInt(this.value);
            currentPage = 1;
            initPagination();
        });
    }
    
    if (firstPageBtn) firstPageBtn.addEventListener('click', function() {
        currentPage = 1;
        updatePaginationDisplay();
        showCurrentPage();
    });
    
    if (prevPageBtn) prevPageBtn.addEventListener('click', function() {
        if (currentPage > 1) {
            currentPage--;
            updatePaginationDisplay();
            showCurrentPage();
        }
    });
    
    if (nextPageBtn) nextPageBtn.addEventListener('click', function() {
        if (currentPage < totalPages) {
            currentPage++;
            updatePaginationDisplay();
            showCurrentPage();
        }
    });
    
    if (lastPageBtn) lastPageBtn.addEventListener('click', function() {
        currentPage = totalPages;
        updatePaginationDisplay();
        showCurrentPage();
    });
    
    if (toggleColumnsBtn) toggleColumnsBtn.addEventListener('click', toggleColumns);
    if (exportTableBtn) exportTableBtn.addEventListener('click', exportTableToCSV);
    if (printTableBtn) printTableBtn.addEventListener('click', printTable);
    
    if (fixedHeadersSwitch) {
        fixedHeadersSwitch.addEventListener('change', function() {
            const tableHeaders = document.querySelectorAll('.table th');
            if (this.checked) {
                tableHeaders.forEach(th => {
                    th.style.position = 'sticky';
                    th.style.top = '0';
                    th.style.zIndex = '10';
                });
            } else {
                tableHeaders.forEach(th => {
                    th.style.position = '';
                    th.style.top = '';
                    th.style.zIndex = '';
                });
            }
        });
    }
    
    // Fonction de recherche dans le tableau
    function searchTable() {
        const searchInput = document.getElementById('tableSearch');
        if (!searchInput) return;
        
        const searchTerm = searchInput.value.toLowerCase().trim();
        const table = document.querySelector('.table');
        if (!table) return;
        
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        let matchCount = 0;
        
        rows.forEach(row => {
            // Ignorer les lignes d'alerte (pas de donnÃ©es)
            if (row.querySelector('.alert')) {
                return;
            }
            
            const text = row.textContent.toLowerCase();
            const match = searchTerm === '' || text.includes(searchTerm);
            
            // Marquer la ligne comme correspondante ou non
            row.dataset.searchMatch = match ? 'true' : 'false';
            
            if (match) matchCount++;
        });
        
        // Mettre Ã  jour le compteur de rÃ©sultats
        totalRecords = matchCount;
        
        // RÃ©initialiser la pagination avec les rÃ©sultats filtrÃ©s
        currentPage = 1;
        initPagination();
        
        // Afficher un message si aucun rÃ©sultat
        const noResultsRow = table.querySelector('.no-results-row');
        if (noResultsRow) {
            noResultsRow.remove();
        }
        
        if (matchCount === 0 && searchTerm !== '') {
            const tbody = table.querySelector('tbody');
            const newRow = document.createElement('tr');
            newRow.className = 'no-results-row';
            newRow.innerHTML = `
                <td colspan="27" class="text-center py-4">
                    <div class="alert alert-warning m-0">
                        <i class="fas fa-exclamation-triangle me-2"></i> Aucun rÃ©sultat trouvÃ© pour "${searchTerm}".
                    </div>
                </td>
            `;
            tbody.appendChild(newRow);
        }
    }
    
    // Fonction pour afficher les lignes de la page courante avec prise en compte de la recherche
    function showCurrentPage() {
        const table = document.querySelector('.table');
        if (!table) return;
        
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        const matchingRows = rows.filter(row => row.dataset.searchMatch !== 'false');
        
        // Masquer toutes les lignes
        rows.forEach(row => {
            row.style.display = 'none';
        });
        
        // Si aucun rÃ©sultat de recherche ou ligne d'alerte, afficher ces lignes spÃ©ciales
        const noResultsRow = table.querySelector('.no-results-row');
        const alertRow = table.querySelector('.alert')?.closest('tr');
        
        if (noResultsRow) {
            noResultsRow.style.display = '';
            return;
        }
        
        if (alertRow && matchingRows.length === 0) {
            alertRow.style.display = '';
            return;
        }
        
        if (pageSize === -1) {
            // Afficher toutes les lignes correspondantes
            matchingRows.forEach(row => {
                row.style.display = '';
            });
        } else {
            // Calculer les indices de dÃ©but et de fin
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, matchingRows.length);
            
            // Afficher les lignes de la page courante
            for (let i = startIndex; i < endIndex; i++) {
                if (matchingRows[i]) matchingRows[i].style.display = '';
            }
        }
    }
    
    // Fonction simplifiÃ©e pour afficher l'intÃ©gralitÃ© du tableau du personnel
    function showAllPersonnel() {
        // 1. Configurer le conteneur du tableau pour afficher les barres de dÃ©filement
        const tableContainer = document.querySelector('.table-responsive');
        if (tableContainer) {
            tableContainer.style.overflowX = 'scroll';
            tableContainer.style.overflowY = 'scroll';
            tableContainer.style.maxHeight = '600px';
            tableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // 2. Afficher toutes les lignes du tableau
        const table = document.querySelector('.table');
        if (table) {
            // Afficher toutes les colonnes
            const headers = Array.from(table.querySelectorAll('thead th'));
            headers.forEach((header, index) => {
                const cells = table.querySelectorAll(`tr > *:nth-child(${index + 1})`);
                cells.forEach(cell => cell.style.display = '');
            });
            
            // Afficher toutes les lignes
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            rows.forEach(row => {
                row.style.display = '';
                row.dataset.searchMatch = 'true';
            });
            
            // Mettre Ã  jour le compteur
            totalRecords = rows.length;
            
            // Ajouter un effet visuel
            table.classList.add('table-highlight-animation');
            setTimeout(() => table.classList.remove('table-highlight-animation'), 2000);
        }
        
        // 3. DÃ©sactiver la pagination
        const pageSizeSelect = document.getElementById('tablePageSize');
        if (pageSizeSelect) {
            pageSizeSelect.value = '-1';
        }
        pageSize = -1;
        currentPage = 1;
        
        // 4. RÃ©initialiser la recherche
        const searchInput = document.getElementById('tableSearch');
        if (searchInput) {
            searchInput.value = '';
        }
        
        // 5. Afficher un message de confirmation
        const alertContainer = document.createElement('div');
        alertContainer.className = 'alert alert-success alert-dismissible fade show mt-2';
        alertContainer.innerHTML = `
            <i class="fas fa-check-circle me-2"></i> Affichage complet du personnel pastoral (${totalRecords} personnes).
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        const cardBody = document.querySelector('.card-body');
        if (cardBody) {
            cardBody.insertBefore(alertContainer, cardBody.firstChild);
            setTimeout(() => alertContainer.remove(), 5000);
        }
    }
    
    // Fonction pour mettre Ã  jour l'affichage de la pagination
    function updatePagination() {
        // Calculer le nombre total de pages
        if (pageSize <= 0) {
            totalPages = 1;
        } else {
            const matchingRows = Array.from(document.querySelectorAll('tbody tr[data-search-match="true"]'));
            totalRecords = matchingRows.length;
            totalPages = Math.ceil(totalRecords / pageSize);
        }
        
        // Mettre Ã  jour l'affichage de la pagination
        const paginationInfo = document.getElementById('paginationInfo');
        if (paginationInfo) {
            if (pageSize <= 0 || totalRecords === 0) {
                paginationInfo.textContent = `Affichage de tous les enregistrements (${totalRecords} au total)`;
            } else {
                const start = (currentPage - 1) * pageSize + 1;
                const end = Math.min(start + pageSize - 1, totalRecords);
                paginationInfo.textContent = `Affichage de ${start} Ã  ${end} sur ${totalRecords} enregistrements`;
            }
        }
        
        // Mettre Ã  jour les boutons de pagination
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        
        if (prevPageBtn) {
            prevPageBtn.disabled = currentPage <= 1;
        }
        
        if (nextPageBtn) {
            nextPageBtn.disabled = currentPage >= totalPages;
        }
        
        // Afficher ou masquer les lignes selon la pagination
        const rows = Array.from(document.querySelectorAll('tbody tr'));
        
        if (pageSize <= 0) {
            // Afficher toutes les lignes correspondantes
            rows.forEach(row => {
                if (row.dataset.searchMatch === 'true') {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        } else {
            // Calculer les indices de dÃ©but et de fin
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, totalRecords);
            
            // Compteur pour suivre les lignes correspondantes
            let matchCount = 0;
            
            // Afficher les lignes de la page courante
            rows.forEach(row => {
                if (row.dataset.searchMatch === 'true') {
                    if (matchCount >= startIndex && matchCount < endIndex) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                    matchCount++;
                } else {
                    row.style.display = 'none';
                }
            });
        }
    }
    
    // Fonction pour initialiser la pagination
    function initPagination() {
        console.log('Initialisation de la pagination');
        
        // Initialiser les attributs data-search-match pour toutes les lignes
        const rows = Array.from(document.querySelectorAll('tbody tr'));
        rows.forEach(row => {
            row.dataset.searchMatch = 'true';
        });
        
        // Mettre Ã  jour le nombre total d'enregistrements
        totalRecords = rows.length;
        
        // Configurer les Ã©vÃ©nements de pagination
        const pageSizeSelect = document.getElementById('tablePageSize');
        if (pageSizeSelect) {
            pageSizeSelect.addEventListener('change', function() {
                pageSize = parseInt(this.value);
                currentPage = 1;
                updatePagination();
            });
        }
        
        const prevPageBtn = document.getElementById('prevPage');
        if (prevPageBtn) {
            prevPageBtn.addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updatePagination();
                }
            });
        }
        
        const nextPageBtn = document.getElementById('nextPage');
        if (nextPageBtn) {
            nextPageBtn.addEventListener('click', function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    updatePagination();
                }
            });
        }
        
        // Mettre Ã  jour l'affichage initial
        updatePagination();
    }
    
    // Fonction de recherche dans le tableau
    function searchTable() {
        console.log('Recherche dans le tableau');
        
        const searchInput = document.getElementById('tableSearch');
        if (!searchInput) return;
        
        const searchTerm = searchInput.value.toLowerCase().trim();
        const rows = Array.from(document.querySelectorAll('tbody tr'));
        
        // Marquer les lignes correspondantes
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            const match = searchTerm === '' || text.includes(searchTerm);
            row.dataset.searchMatch = match ? 'true' : 'false';
        });
        
        // RÃ©initialiser la pagination Ã  la premiÃ¨re page
        currentPage = 1;
        
        // Mettre Ã  jour l'affichage
        updatePagination();
        
        // Afficher un message si aucun rÃ©sultat
        const matchingRows = rows.filter(row => row.dataset.searchMatch === 'true');
        const noResultsMessage = document.getElementById('noResultsMessage');
        
        if (noResultsMessage) {
            if (matchingRows.length === 0 && searchTerm !== '') {
                noResultsMessage.textContent = `Aucun rÃ©sultat trouvÃ© pour "${searchTerm}"`;
                noResultsMessage.style.display = 'block';
            } else {
                noResultsMessage.style.display = 'none';
            }
        }
    }
    
    // Initialiser la pagination et la recherche au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Page chargÃ©e, initialisation des fonctionnalitÃ©s');
        
        // Initialiser la recherche
        const searchInput = document.getElementById('tableSearch');
        if (searchInput) {
            // Utiliser un dÃ©lai pour Ã©viter de rechercher Ã  chaque frappe
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(searchTable, 300);
            });
            
            // Effacer la recherche avec le bouton
            const clearSearchBtn = document.getElementById('clearSearch');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', function() {
                    searchInput.value = '';
                    searchTable();
                });
            }
        }
        
        // GÃ©rer le bouton "Voir le Personnel"
        const viewAllPersonnelBtn = document.getElementById('viewAllPersonnelBtn');
        if (viewAllPersonnelBtn) {
            viewAllPersonnelBtn.addEventListener('click', function() {
                console.log('Bouton Voir le Personnel cliquÃ©');
                showAllPersonnel();
            });
        }
        
        // Mettre en Ã©vidence les colonnes spÃ©cifiques demandÃ©es
        highlightSpecificColumns();
        
        // Initialiser la pagination
        initPagination();
        
        // Initialiser la camÃ©ra pour le formulaire Personnel Pastoral
        console.log('Initialisation de la camÃ©ra au chargement de la page...');
        setTimeout(() => {
            initializeCamera();
            setupPhotoInputListener(); // Ajouter l'event listener pour l'import d'image
        }, 500); // DÃ©lai pour s'assurer que tous les Ã©lÃ©ments sont chargÃ©s
    });
    
    // Fonction pour mettre en Ã©vidence les colonnes spÃ©cifiques demandÃ©es
    function highlightSpecificColumns() {
        const columnsToHighlight = [
            'Lieu de consÃ©cration',
            'ConsacrÃ© par qui ?',
            'PrÃ©noms du PÃ¨re',
            'PrÃ©noms & Nom de la MÃ¨re'
        ];
        
        const table = document.querySelector('.table');
        if (!table) return;
        
        const headers = Array.from(table.querySelectorAll('thead th'));
        
        // Trouver les indices des colonnes Ã  mettre en Ã©vidence
        const highlightIndices = [];
        headers.forEach((header, index) => {
            const headerText = header.textContent.trim();
            if (columnsToHighlight.includes(headerText)) {
                highlightIndices.push(index);
                
                // S'assurer que cette colonne est visible
                header.style.display = '';
                const cells = table.querySelectorAll(`tbody tr td:nth-child(${index + 1})`);
                cells.forEach(cell => {
                    cell.style.display = '';
                });
            }
        });
        
        // Appliquer le style aux en-tÃªtes et cellules des colonnes spÃ©cifiques
        highlightIndices.forEach(index => {
            // Mettre en Ã©vidence l'en-tÃªte
            const header = headers[index];
            header.style.backgroundColor = '#ffeeba';
            header.style.color = '#856404';
            header.style.fontWeight = 'bold';
            header.style.border = '2px solid #ffc107';
            
            // Mettre en Ã©vidence toutes les cellules de cette colonne
            const cells = table.querySelectorAll(`tbody tr td:nth-child(${index + 1})`);
            cells.forEach(cell => {
                cell.style.backgroundColor = '#fff3cd';
                cell.style.border = '1px solid #ffc107';
            });
        });
    }
    
    // GÃ©rer le bouton "Quitter le formulaire" s'il existe
    const quitterFormulaireBtn = document.getElementById('quitterFormulaireBtn');
    if (quitterFormulaireBtn) {
        quitterFormulaireBtn.addEventListener('click', function() {
            // Demander confirmation avant de quitter
            if (confirm('ÃŠtes-vous sÃ»r de vouloir quitter le formulaire ? Toutes les donnÃ©es non sauvegardÃ©es seront perdues.')) {
                // ArrÃªter la camÃ©ra si elle est active
                stopCamera();
                
                // RÃ©initialiser le formulaire
                const personnelForm = document.getElementById('personnelForm');
                if (personnelForm) {
                    personnelForm.reset();
                    console.log('Formulaire rÃ©initialisÃ©');
                }
                
                // Masquer les Ã©lÃ©ments de prÃ©visualisation photo
                if (photoPreview) photoPreview.style.display = 'none';
                if (clearPhotoBtn) clearPhotoBtn.style.display = 'none';
                capturedImageData = null;
            }
        });
    }

});
</script>

<!-- Inclure les fichiers JavaScript -->
<script src="{% static 'js/personnel_pastoral.js' %}"></script>
<script src="{% static 'main/js/personnel_pastoral_fix.js' %}"></script>
<script src="{% static 'main/js/personnel_pastoral_buttons.js' %}"></script>

<!-- Script autonome pour le bouton "Voir le Personnel" -->
<script>
// Script amÃ©liorÃ© pour gÃ©rer le bouton "Voir le Personnel" et la fenÃªtre modale
(function() {
    // Initialisation du bouton "Voir le Personnel"
    const viewBtn = document.getElementById('viewAllPersonnelBtn');
    if (viewBtn) {
        console.log('Bouton Voir le Personnel trouvÃ©');
        
        viewBtn.onclick = function() {
            console.log('Clic sur le bouton Voir le Personnel');
            
            // Afficher le message de chargement
            const messageContainer = document.getElementById('modalTableMessage');
            if (messageContainer) {
                messageContainer.classList.remove('d-none', 'alert-danger');
                messageContainer.classList.add('alert-info');
                messageContainer.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Chargement du tableau...';
            }
            
            // Ouvrir la fenÃªtre modale pour afficher le tableau complet
            const modalElement = document.getElementById('viewAllPersonnelModal');
            if (modalElement) {
                const personnelModal = new bootstrap.Modal(modalElement);
                personnelModal.show();
                
                // PrÃ©parer le tableau dans la modale aprÃ¨s l'ouverture
                setTimeout(() => {
                    prepareFullPersonnelTable();
                }, 300); // DÃ©lai court pour permettre Ã  la modale de s'afficher complÃ¨tement
            } else {
                console.error('Modal non trouvÃ©e');
                alert('Erreur: Impossible d\'afficher le tableau complet du personnel.');
            }
            
            return false;
        };
    } else {
        console.error('Bouton Voir le Personnel non trouvÃ©');
    }
    
    // Initialisation des boutons de la modale
    document.addEventListener('DOMContentLoaded', function() {
        // Bouton pour effacer la recherche
        const clearSearchBtn = document.getElementById('clearModalSearch');
        if (clearSearchBtn) {
            clearSearchBtn.addEventListener('click', function() {
                const searchInput = document.getElementById('modalTableSearch');
                if (searchInput) {
                    searchInput.value = '';
                    searchModalTable('');
                    searchInput.focus();
                }
            });
        }
        
        // Bouton d'impression
        const printBtn = document.getElementById('printModalTableBtn');
        if (printBtn) {
            printBtn.addEventListener('click', function() {
                printModalTable();
            });
        }
        
        // Bouton d'exportation CSV
        const exportBtn = document.getElementById('exportCSVBtn');
        if (exportBtn) {
            exportBtn.addEventListener('click', function() {
                exportTableToCSV('personnel_pastoral.csv');
            });
        }
    });
    
    // Fonction pour prÃ©parer le tableau complet dans la modale
    function prepareFullPersonnelTable() {
        try {
            // RÃ©cupÃ©rer le tableau original
            const originalTable = document.querySelector('.table');
            const modalTableContainer = document.getElementById('modalTableContainer');
            const messageContainer = document.getElementById('modalTableMessage');
            
            if (!originalTable) {
                showModalMessage('Erreur: Tableau du personnel non trouvÃ©.', 'danger');
                return;
            }
            
            if (!modalTableContainer) {
                showModalMessage('Erreur: Conteneur modal non trouvÃ©.', 'danger');
                return;
            }
            
            // Cloner le tableau pour la modale
            const clonedTable = originalTable.cloneNode(true);
            clonedTable.id = 'modalPersonnelTable';
            clonedTable.classList.add('table-bordered', 'table-striped', 'table-hover');
            
            // Vider le conteneur de la modale et ajouter le tableau clonÃ©
            modalTableContainer.innerHTML = '';
            modalTableContainer.appendChild(clonedTable);
            
            // Afficher toutes les lignes et colonnes dans le tableau clonÃ©
            const headers = Array.from(clonedTable.querySelectorAll('thead th'));
            headers.forEach((header, index) => {
                const cells = clonedTable.querySelectorAll(`tr > *:nth-child(${index + 1})`);
                cells.forEach(cell => cell.style.display = '');
            });
            
            // Mettre en Ã©vidence les colonnes spÃ©cifiques demandÃ©es
            const columnsToHighlight = [
                'Lieu de consÃ©cration',
                'ConsacrÃ© par qui ?',
                'PrÃ©noms du PÃ¨re',
                'PrÃ©noms & Nom de la MÃ¨re'
            ];
            
            // Trouver les indices des colonnes Ã  mettre en Ã©vidence
            const highlightIndices = [];
            headers.forEach((header, index) => {
                const headerText = header.textContent.trim();
                if (columnsToHighlight.includes(headerText)) {
                    highlightIndices.push(index);
                    
                    // S'assurer que cette colonne est visible
                    header.style.display = '';
                    const cells = clonedTable.querySelectorAll(`tbody tr td:nth-child(${index + 1})`);
                    cells.forEach(cell => {
                        cell.style.display = '';
                    });
                }
            });
            
            // Appliquer le style aux en-tÃªtes et cellules des colonnes spÃ©cifiques
            highlightIndices.forEach(index => {
                // Mettre en Ã©vidence l'en-tÃªte
                const header = headers[index];
                header.style.backgroundColor = '#ffeeba';
                header.style.color = '#856404';
                header.style.fontWeight = 'bold';
                header.style.border = '2px solid #ffc107';
                
                // Mettre en Ã©vidence toutes les cellules de cette colonne
                const cells = clonedTable.querySelectorAll(`tbody tr td:nth-child(${index + 1})`);
                cells.forEach(cell => {
                    cell.style.backgroundColor = '#fff3cd';
                    cell.style.border = '1px solid #ffc107';
                });
            });
            
            const rows = Array.from(clonedTable.querySelectorAll('tbody tr'));
            rows.forEach(row => {
                row.style.display = '';
                row.dataset.searchMatch = 'true';
            });
            
            // Mettre Ã  jour le compteur dans la modale
            const totalRecords = rows.length;
            const modalTitle = document.getElementById('viewAllPersonnelModalLabel');
            if (modalTitle) {
                modalTitle.innerHTML = `<i class="fas fa-users me-2"></i> Liste ComplÃ¨te du Personnel Pastoral <span class="badge bg-light text-primary">${totalRecords} personnes</span>`;
            }
            
            // Configurer la recherche dans la modale
            const modalSearch = document.getElementById('modalTableSearch');
            if (modalSearch) {
                modalSearch.value = '';
                modalSearch.addEventListener('input', function() {
                    searchModalTable(this.value);
                });
                // Focus sur le champ de recherche
                setTimeout(() => modalSearch.focus(), 500);
            }
            
            // Mettre Ã  jour le compteur de rÃ©sultats
            const resultCounter = document.getElementById('modalSearchResults');
            if (resultCounter) {
                resultCounter.textContent = `${totalRecords} personnes au total`;
            }
            
            // Cacher le message de chargement
            if (messageContainer) {
                messageContainer.classList.add('d-none');
            }
            
            // Ajouter des classes pour l'impression
            clonedTable.classList.add('print-friendly');
            
        } catch (error) {
            console.error('Erreur lors de la prÃ©paration du tableau:', error);
            showModalMessage(`Erreur lors de la prÃ©paration du tableau: ${error.message}`, 'danger');
        }
    }
    
    // Fonction pour afficher un message dans la modale
    function showModalMessage(message, type = 'info') {
        const messageContainer = document.getElementById('modalTableMessage');
        if (messageContainer) {
            messageContainer.classList.remove('d-none', 'alert-info', 'alert-danger', 'alert-success', 'alert-warning');
            messageContainer.classList.add(`alert-${type}`);
            
            let icon = 'info-circle';
            if (type === 'danger') icon = 'exclamation-triangle';
            else if (type === 'success') icon = 'check-circle';
            else if (type === 'warning') icon = 'exclamation-circle';
            
            messageContainer.innerHTML = `<i class="fas fa-${icon} me-2"></i> ${message}`;
        }
    }
    
    // Fonction de recherche amÃ©liorÃ©e dans le tableau modal
    function searchModalTable(query) {
        const table = document.getElementById('modalPersonnelTable');
        if (!table) return;
        
        const rows = Array.from(table.querySelectorAll('tbody tr'));
        const lowerQuery = query.toLowerCase().trim();
        let matchCount = 0;
        
        // Si la requÃªte est vide, afficher toutes les lignes
        if (lowerQuery === '') {
            rows.forEach(row => {
                row.style.display = '';
                row.classList.remove('search-highlight');
            });
            matchCount = rows.length;
        } else {
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const match = text.includes(lowerQuery);
                row.style.display = match ? '' : 'none';
                
                // Ajouter une classe de surbrillance pour les lignes correspondantes
                if (match) {
                    matchCount++;
                    row.classList.add('search-highlight');
                } else {
                    row.classList.remove('search-highlight');
                }
            });
        }
        
        // Mettre Ã  jour le compteur de rÃ©sultats
        const resultCounter = document.getElementById('modalSearchResults');
        if (resultCounter) {
            if (lowerQuery === '') {
                resultCounter.textContent = `${rows.length} personnes au total`;
                resultCounter.className = 'text-muted fw-bold';
            } else if (matchCount === 0) {
                resultCounter.textContent = `Aucun rÃ©sultat pour "${query}"`;
                resultCounter.className = 'text-danger fw-bold';
            } else {
                resultCounter.textContent = `${matchCount} rÃ©sultat(s) pour "${query}"`;
                resultCounter.className = 'text-success fw-bold';
            }
        }
        
        // Afficher un message si aucun rÃ©sultat
        if (matchCount === 0 && lowerQuery !== '') {
            showModalMessage(`Aucun rÃ©sultat trouvÃ© pour "${query}". Essayez un autre terme de recherche.`, 'warning');
        } else {
            const messageContainer = document.getElementById('modalTableMessage');
            if (messageContainer) {
                messageContainer.classList.add('d-none');
            }
        }
    }
    
    // Fonction pour imprimer le tableau modal
    function printModalTable() {
        const modalContent = document.getElementById('modalTableContainer');
        if (!modalContent) return;
        
        const printWindow = window.open('', '_blank');
        
        if (!printWindow) {
            alert("Veuillez autoriser les fenÃªtres pop-up pour imprimer le tableau.");
            return;
        }
        
        const modalTitle = document.getElementById('viewAllPersonnelModalLabel');
        const title = modalTitle ? modalTitle.textContent : 'Liste du Personnel Pastoral';
        
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>${title}</title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    .print-header { text-align: center; margin-bottom: 20px; }
                    .print-header h2 { margin-bottom: 5px; }
                    .print-date { margin-bottom: 20px; font-style: italic; text-align: right; }
                    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                    th, td { border: 1px solid #ddd; padding: 8px; }
                    th { background-color: #f2f2f2; }
                    .text-center { text-align: center; }
                    .rounded-circle { border-radius: 50%; }
                </style>
            </head>
            <body>
                <div class="print-header">
                    <h2>${title}</h2>
                    <p>Ã‰glise Ã‰vangÃ©lique du Plein Ã‰vangile</p>
                </div>
                <div class="print-date">
                    Date d'impression: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}
                </div>
                ${modalContent.innerHTML}
            </body>
            </html>
        `);
        
        printWindow.document.close();
        printWindow.focus();
        
        // Attendre que le contenu soit chargÃ© avant d'imprimer
        setTimeout(() => {
            printWindow.print();
            // Ne pas fermer la fenÃªtre aprÃ¨s l'impression pour permettre Ã  l'utilisateur de voir le rÃ©sultat
        }, 500);
    }
    
    // Fonction pour exporter le tableau en CSV
    function exportTableToCSV(filename) {
        const table = document.getElementById('modalPersonnelTable');
        if (!table) {
            alert("Tableau non trouvÃ© pour l'exportation.");
            return;
        }
        
        try {
            // Collecter les en-tÃªtes
            const headers = [];
            const headerCells = table.querySelectorAll('thead th');
            headerCells.forEach(cell => {
                if (cell.style.display !== 'none') {
                    headers.push('"' + cell.textContent.trim().replace(/"/g, '""') + '"');
                }
            });
            
            // Collecter les donnÃ©es des lignes
            const rows = [];
            const dataCells = table.querySelectorAll('tbody tr');
            dataCells.forEach(row => {
                if (row.style.display !== 'none') { // Ne prendre que les lignes visibles (pour respecter la recherche)
                    const rowData = [];
                    row.querySelectorAll('td').forEach(cell => {
                        if (cell.style.display !== 'none') {
                            // Nettoyer le texte (enlever les boutons, etc.)
                            const text = cell.textContent.trim().replace(/\s+/g, ' ').replace(/"/g, '""');
                            rowData.push('"' + text + '"');
                        }
                    });
                    rows.push(rowData.join(','));
                }
            });
            
            // CrÃ©er le contenu CSV
            const csvContent = headers.join(',') + '\n' + rows.join('\n');
            
            // CrÃ©er un lien de tÃ©lÃ©chargement
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showModalMessage(`Exportation rÃ©ussie! Le fichier ${filename} a Ã©tÃ© tÃ©lÃ©chargÃ©.`, 'success');
            setTimeout(() => {
                const messageContainer = document.getElementById('modalTableMessage');
                if (messageContainer) messageContainer.classList.add('d-none');
            }, 3000);
            
        } catch (error) {
            console.error('Erreur lors de l\'exportation CSV:', error);
            showModalMessage(`Erreur lors de l'exportation: ${error.message}`, 'danger');
        }
    }
})();
</script>
    </div>
</div>

<!-- Modal pour afficher le tableau complet du personnel -->
<div class="modal fade" id="viewAllPersonnelModal" tabindex="-1" aria-labelledby="viewAllPersonnelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="viewAllPersonnelModalLabel">
                    <i class="fas fa-users me-2"></i> Liste ComplÃ¨te du Personnel Pastoral
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Barre de recherche pour la modale -->
                <div class="mb-3 d-flex justify-content-between align-items-center flex-wrap">
                    <div class="input-group mb-2 mb-md-0" style="max-width: 400px;">
                        <span class="input-group-text bg-primary text-white">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text" class="form-control" id="modalTableSearch" placeholder="Rechercher dans le personnel...">
                        <button class="btn btn-outline-secondary" type="button" id="clearModalSearch">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="modalSearchResults" class="text-muted fw-bold"></div>
                </div>
                
                <!-- Message d'erreur ou de chargement -->
                <div id="modalTableMessage" class="alert alert-info d-none">
                    <i class="fas fa-spinner fa-spin me-2"></i> Chargement du tableau...
                </div>
                
                <!-- Conteneur pour le tableau clonÃ© -->
                <div id="modalTableContainer" class="table-responsive" style="max-height: 70vh; overflow-y: auto; overflow-x: auto;"></div>
            </div>
            <div class="modal-footer d-flex justify-content-between">
                <div>
                    <button type="button" class="btn btn-outline-primary" id="exportCSVBtn">
                        <i class="fas fa-file-csv me-1"></i> Exporter CSV
                    </button>
                </div>
                <div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> Fermer
                    </button>
                    <button type="button" class="btn btn-primary" id="printModalTableBtn">
                        <i class="fas fa-print me-1"></i> Imprimer
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

